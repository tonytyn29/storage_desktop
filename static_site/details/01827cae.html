<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大小市值双因子轮动 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>大小市值双因子轮动</h1>
        <p class="meta">
            ID: 01827cae | 
            类型: 多因子选股+小市值轮动 | 
            来源: b25_45此消彼长.txt |
            分析日期: 2026-01-10 22:28:36
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>每月用 4 个基本面/量价混合因子线性打分，取前 10% 中最小流通市值的若干“小票”+ 基本面过滤后按总市值从大到小挑选若干“大票”，共持 10 只左右。预期通过挑选高预期收益分数且质地较好、估值合理的小盘和大盘股票，在大小风格轮动中获取超额收益；对前一日涨停的持仓做盘中‘板块分歧’卖出，博取短期溢价同时控制回撤。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>全 A（剔除 ST、带＊、退、停牌、科创板 688/北交 8xxx/4xxx、新股上市 &lt; 375 天、当日涨跌停）</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>月初开盘：因子得分位于全市场前 10%，且满足各自的“小市值/正 EPS”或“大市值+多重财务过滤”条件, 组合目标数量 &gt; 现有持仓时，按等权资金把剩余现金分配买入</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>月初：不在最新目标名单且前一日未涨停的持仓全部清仓, 若上一交易日涨停的个股在 14:00 观察到打开涨停，则立即卖出</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>最多约 10 只股票，单票等权（价值上限＝当期现金/缺口数）。无止损/止盈，仅有‘涨停打开’特殊处理；无整体仓位控制，理论上满仓。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>月调仓一次（run_monthly 在每月第 1 个交易日开盘成交）；另外可能出现日内 14:00 的个别卖出。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>若手动执行：
1) 月首盘前跑一遍筛选，开盘后立即下等额买单；
2) 每日下午 14:00 检查昨日涨停股是否打开，打开立刻市价卖；
3) 盘后记录持仓与成交及因子值，准备下月更新。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>使用 get_all_securities() 时未指定 date，回测引擎将返回最新（回测时刻之后的）证券列表，造成‘未上市先选中’未来信息泄漏；其他数据调用均以 yesterday 或当日 9:30 前数据为基准，相对安全。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>jqfactor 部分因子可能已用未来报表做回填，需确认因子库的时点一致性, 盘中 14:00 使用 1 分钟收盘价判断涨停打开——在极端情况下存在数据延迟/误判风险, 满仓等权 + 无止损，对极端系统性风险暴露较高</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>小资金 (&lt;1000 万) 通过分批限价基本可执行；更大规模易受流动性和冲击成本限制。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>几乎无冲击，人工也能执行。</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>大部分小盘股可一次性成交，但需注意封单薄弱时的冲击。</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>需分批挂单，可能买不齐/成交价偏离；开放式基金难以完全复制。</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>策略难以执行，小盘持仓容量不足，需放弃小盘部分或重构逻辑。</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>一半组合来自流通市值排名最低的股票，容量小，冲击大。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>利用涨停惯性 + 月度因子，含一定市场情绪捕捉但并非纯炒情绪。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>线性回归系数静态写死、因子少；市场风格切换或因子失效时收益可能显著下降。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>小盘股持续杀估值、流动性枯竭的熊市, 月初大幅高开后快速跳水导致集中建仓被套</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>组合在牛市小盘风格阶段将显著超越 399303（中证 1000）, 若上一日封板次日开板，当天下午卖出能显著减少当月回撤, 小盘半边组合贡献的超额收益&gt;大盘半边</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>典型的月频多因子+小盘进攻策略，逻辑简洁但对未来函数处理疏漏、容量有限。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>1) 修正 get_all_securities 的未来泄漏；2) 动态更新回归系数或增加因子稳健性；3) 引入流动性过滤并优化交易执行（分批、限价）。</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>未提供资金规模，默认按回测初始 100 万等权分配, 使用 JoinQuant 默认撮合（T+0 回测撮合、实际 A 股 T+1 交收），滑点已被 set_slippage(0) 关闭，实盘需重新评估</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>5</td></tr>
                <tr><td>滑点</td><td>6</td></tr>
                <tr><td>成本</td><td>4</td></tr>
                <tr><td>执行难度</td><td>5</td></tr>
                <tr><td>时间敏感性</td><td>5</td></tr>
                <tr><td>综合可执行性</td><td>5.8</td></tr>
                <tr><td>大资金不友好</td><td>7</td></tr>
                <tr><td>行为偏差利用</td><td>5</td></tr>
                <tr><td>跨阶段稳健性</td><td>5</td></tr>
                <tr><td>有效性总分</td><td>5.7</td></tr>
                <tr><td>总分</td><td>57.7</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;大小市值双因子轮动&quot;,
    &quot;strategy_type&quot;: &quot;多因子选股+小市值轮动&quot;,

    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;每月用 4 个基本面/量价混合因子线性打分，取前 10% 中最小流通市值的若干“小票”+ 基本面过滤后按总市值从大到小挑选若干“大票”，共持 10 只左右。预期通过挑选高预期收益分数且质地较好、估值合理的小盘和大盘股票，在大小风格轮动中获取超额收益；对前一日涨停的持仓做盘中‘板块分歧’卖出，博取短期溢价同时控制回撤。&quot;,
        &quot;data_and_indicators&quot;: &quot;1) jqfactor 四个因子（非经常损益、非经营性净利 TTM、8 年 ROE TTM、20 日夏普）——月度在昨日收盘时点取值。\n2) 基础财务指标（PE、PS、PCF、EPS、ROE、净利率、毛利率、收入 YoY）——月度取值。\n3) 行情数据：日线 close/high_limit；分钟线 close、涨跌停价（用于盘中涨停判断）。\n4) 股票基础信息（上市日期、是否 ST、是否停牌、科创/北交所标识）。&quot;,
        &quot;stock_pool&quot;: &quot;全 A（剔除 ST、带＊、退、停牌、科创板 688/北交 8xxx/4xxx、新股上市 &lt; 375 天、当日涨跌停）&quot;,
        &quot;buy_signals&quot;: [
            &quot;月初开盘：因子得分位于全市场前 10%，且满足各自的“小市值/正 EPS”或“大市值+多重财务过滤”条件&quot;,
            &quot;组合目标数量 &gt; 现有持仓时，按等权资金把剩余现金分配买入&quot;
        ],
        &quot;sell_signals&quot;: [
            &quot;月初：不在最新目标名单且前一日未涨停的持仓全部清仓&quot;,
            &quot;若上一交易日涨停的个股在 14:00 观察到打开涨停，则立即卖出&quot;
        ],
        &quot;position_and_risk&quot;: &quot;最多约 10 只股票，单票等权（价值上限＝当期现金/缺口数）。无止损/止盈，仅有‘涨停打开’特殊处理；无整体仓位控制，理论上满仓。&quot;,
        &quot;trading_frequency&quot;: &quot;月调仓一次（run_monthly 在每月第 1 个交易日开盘成交）；另外可能出现日内 14:00 的个别卖出。&quot;,
        &quot;manual_execution_guide&quot;: &quot;若手动执行：\n1) 月首盘前跑一遍筛选，开盘后立即下等额买单；\n2) 每日下午 14:00 检查昨日涨停股是否打开，打开立刻市价卖；\n3) 盘后记录持仓与成交及因子值，准备下月更新。&quot;
    },

    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;是&quot;,
        &quot;risk_level&quot;: &quot;中&quot;,
        &quot;risk_score&quot;: 5,
        &quot;risk_score_reason&quot;: &quot;使用 get_all_securities() 时未指定 date，回测引擎将返回最新（回测时刻之后的）证券列表，造成‘未上市先选中’未来信息泄漏；其他数据调用均以 yesterday 或当日 9:30 前数据为基准，相对安全。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;未见直接未来价引用；history、get_price 均使用 end_date≤当前时点。&quot;,
            &quot;financial_data_leak&quot;: &quot;get_factor_values end_date=yesterday ⇒ 合规；get_fundamentals 未显式指定 date，但运行在当前回测日期，风险可接受。&quot;,
            &quot;index_component_leak&quot;: &quot;因子排序使用未来可能未上市股票（由 get_all_securities 泄漏）会影响排名。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;无其它明显回测引擎漏洞。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;在所有 get_all_securities/get_fundamentals 调用中显式加 date=context.previous_date；或在 prepare_stock_list/ monthly_adjustment里先过滤掉上市日期&gt; yesterday。&quot;,
        &quot;gray_area_warnings&quot;: [
            &quot;jqfactor 部分因子可能已用未来报表做回填，需确认因子库的时点一致性&quot;,
            &quot;盘中 14:00 使用 1 分钟收盘价判断涨停打开——在极端情况下存在数据延迟/误判风险&quot;,
            &quot;满仓等权 + 无止损，对极端系统性风险暴露较高&quot;
        ]
    },

    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 6,
        &quot;slippage_reason&quot;: &quot;小市值片段按流通市值最小排序，若实际资金规模较大，将冲击盘口；月初集中开盘买入加剧冲击。&quot;,
        &quot;cost_score&quot;: 4,
        &quot;cost_reason&quot;: &quot;月度调仓 + 偶发日内卖出，换手率中等；佣金默认万 3、印花税卖出千 1，整体成本可控。&quot;,
        &quot;execution_score&quot;: 5,
        &quot;execution_reason&quot;: &quot;10 只股票、部分是小盘，需分批下单才能成交，尤其是流动性差时。&quot;,
        &quot;time_sensitivity_score&quot;: 5,
        &quot;time_sensitivity_reason&quot;: &quot;买入最好在开盘尽快完成以避免偏离，14:00 的额外监控需要自动化或人工盯盘。&quot;,
        &quot;overall_executability&quot;: 6,
        &quot;overall_reason&quot;: &quot;小资金 (&lt;1000 万) 通过分批限价基本可执行；更大规模易受流动性和冲击成本限制。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;几乎无冲击，人工也能执行。&quot;,
            &quot;100w&quot;: &quot;大部分小盘股可一次性成交，但需注意封单薄弱时的冲击。&quot;,
            &quot;1000w&quot;: &quot;需分批挂单，可能买不齐/成交价偏离；开放式基金难以完全复制。&quot;,
            &quot;1y&quot;: &quot;策略难以执行，小盘持仓容量不足，需放弃小盘部分或重构逻辑。&quot;
        },
        &quot;improvement_suggestions&quot;: [
            &quot;对小盘股设置最低成交额筛选或分级下单算法（VWAP/TWAP）&quot;,
            &quot;增加仓位上限或现金缓冲，降低满仓带来的被动卖出风险&quot;
        ]
    },

    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 7,
        &quot;large_fund_unfriendly_reason&quot;: &quot;一半组合来自流通市值排名最低的股票，容量小，冲击大。&quot;,
        &quot;behavioral_bias_score&quot;: 5,
        &quot;behavioral_bias_reason&quot;: &quot;利用涨停惯性 + 月度因子，含一定市场情绪捕捉但并非纯炒情绪。&quot;,
        &quot;cross_period_robustness_score&quot;: 5,
        &quot;cross_period_robustness_reason&quot;: &quot;线性回归系数静态写死、因子少；市场风格切换或因子失效时收益可能显著下降。&quot;,
        &quot;effectiveness_total_score&quot;: 5.5,
        &quot;weight_explanation&quot;: &quot;大资金不友好40% + 非理性利用30% + 跨阶段稳健30%&quot;,
        &quot;worst_environments&quot;: [
            &quot;小盘股持续杀估值、流动性枯竭的熊市&quot;,
            &quot;月初大幅高开后快速跳水导致集中建仓被套&quot;
        ],
        &quot;verifiable_predictions&quot;: [
            &quot;组合在牛市小盘风格阶段将显著超越 399303（中证 1000）&quot;,
            &quot;若上一日封板次日开板，当天下午卖出能显著减少当月回撤&quot;,
            &quot;小盘半边组合贡献的超额收益&gt;大盘半边&quot;
        ]
    },

    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;典型的月频多因子+小盘进攻策略，逻辑简洁但对未来函数处理疏漏、容量有限。&quot;,
        &quot;recommendation&quot;: &quot;小仓实测&quot;,
        &quot;optimization_suggestions&quot;: &quot;1) 修正 get_all_securities 的未来泄漏；2) 动态更新回归系数或增加因子稳健性；3) 引入流动性过滤并优化交易执行（分批、限价）。&quot;
    },

    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 5,
        &quot;slippage&quot;: 6,
        &quot;cost&quot;: 4,
        &quot;execution&quot;: 5,
        &quot;time_sensitivity&quot;: 5,
        &quot;executability&quot;: 6,
        &quot;effectiveness_a&quot;: 7,
        &quot;effectiveness_b&quot;: 5,
        &quot;effectiveness_c&quot;: 5,
        &quot;effectiveness_total&quot;: 5.5
    },

    &quot;assumptions&quot;: [
        &quot;未提供资金规模，默认按回测初始 100 万等权分配&quot;,
        &quot;使用 JoinQuant 默认撮合（T+0 回测撮合、实际 A 股 T+1 交收），滑点已被 set_slippage(0) 关闭，实盘需重新评估&quot;
    ]
}
```</pre>
        </div>

    </div>
</body>
</html>