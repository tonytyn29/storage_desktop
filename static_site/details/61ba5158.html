<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>单 ETF 网格交易 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>单 ETF 网格交易</h1>
        <p class="meta">
            ID: 61ba5158 | 
            类型: 均值回归 / 网格套利 | 
            来源: b2324_44.！！！最易上手的网格策略v2.0，设置几个参数就可以直接使用.txt |
            分析日期: 2026-01-11 18:17:38
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>先在 60 日均价附近建第一仓，随后按固定 5% 跌幅逐层加仓、按固定 5%-10% 涨幅逐层（或一次性）减仓，通过区间震荡反复低买高卖来获取价差收益。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>仅对用户指定的 ETF（默认 510500）操作；未对 ST / 停牌 / 涨跌停做额外过滤，ETF 本身流动性较好，停牌概率极低。</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>首次建仓：当当前价位于 60 日均价 ±20% 区间内时买入 1 份（默认 2 万元）, 加仓：价格每下跌 5%（net_range）且当前层数 &lt; 最大层数时，再买入 1 份</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>减仓：价格上涨到 base_price ×(1 - net_layer×5% + 10%) 以上时按公式卖出 1 份或全部, 当 net_layer==1 且触发卖出条件时，清空全部仓位</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>每层固定投入 g.per_share（默认 2 万元），最大层数 = 初始现金 / 每层金额；单票集中度 100%，无止损、无总仓位保护。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>handle_data 每分钟检查；若 ETF 波动频繁，一天可能多次触发买卖，否则几天甚至数周不动。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>若手动：
1）盘前设定参数（net_range、per_share 等）。
2）盘中每分钟监控价格与基准价的偏离并下单。
3）盘后更新持仓均价，检查是否有分红拆分并调基准价。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>未使用诸如 history() / attribute_history() 等已知未来函数；get_price/get_bars 使用的是当前或过去区间，handle_data 在每分钟 bar 收盘后执行，理论上未提前看到未来数据。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>get_price 使用当前分钟 close 仍可能在某些回测引擎版本里等同于下一分钟可得值，请在实盘验证, 大额资金时 per_share 过小会导致下单次数暴增，存在撮合性能灰区, 未限制涨跌停下单，若 ETF 发生临停可能产生挂单滞留</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>单票、高流动性、固定网格，技术实现简单；核心难点在参数与资金规模匹配。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>最多 5 层，撮合无压力，策略正常。</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>最多 50 层；一分钟下 50 张单仍可成交，但需要考虑撮合效率与 API 限速。</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>最多 500 层；下单数量巨大，需提高 per_share 或改为批量算法，滑点与爆仓风险上升。</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>≈5000 层，实盘几乎不可行；须把 per_share 提至百万级，或拆分多只 ETF。</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>资金越大，层数越多且集中于单票，撮合与风控压力明显上升。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>主要利用市场波动均值回归，非依赖情绪错价；对行为偏差利用有限。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>网格策略在震荡市较好，单边趋势（尤其是持续下跌）易被套，鲁棒性中等。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>单边下跌或上升的大趋势, 低波动窄幅震荡（不足以覆盖手续费）</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>在 5%-10% 震荡市下，策略累计收益率将显著优于买入并持有, 在月度滚动窗口下，最大回撤与上涨趋势强度正相关, 加大 net_range 至 8%-10% 时，年化换手率下降、单次收益率提升</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>简单有效的小规模 ETF 网格，但对单边趋势及大资金容量有限。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>（1）引入趋势过滤，在明显单边市暂停加仓；（2）per_share 与资金规模动态挂钩；（3）加入止损或时间止盈，提高资金效率。</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>未提供初始资金，默认聚宽回测 100 万元，计算 g.max_net 时以可用资金 / 2 万元。, 使用聚宽默认滑点模型（缺失信息/你的假设）, 订单类型默认市价委托，成交价按下一分钟撮合（缺失信息/你的假设）</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>2</td></tr>
                <tr><td>滑点</td><td>2</td></tr>
                <tr><td>成本</td><td>4</td></tr>
                <tr><td>执行难度</td><td>8</td></tr>
                <tr><td>时间敏感性</td><td>6</td></tr>
                <tr><td>综合可执行性</td><td>6.5</td></tr>
                <tr><td>大资金不友好</td><td>6</td></tr>
                <tr><td>行为偏差利用</td><td>4</td></tr>
                <tr><td>跨阶段稳健性</td><td>5</td></tr>
                <tr><td>有效性总分</td><td>5.2</td></tr>
                <tr><td>总分</td><td>57.8</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;单 ETF 网格交易&quot;,
    &quot;strategy_type&quot;: &quot;均值回归 / 网格套利&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;先在 60 日均价附近建第一仓，随后按固定 5% 跌幅逐层加仓、按固定 5%-10% 涨幅逐层（或一次性）减仓，通过区间震荡反复低买高卖来获取价差收益。&quot;,
        &quot;data_and_indicators&quot;: &quot;1）日线收盘价（60 日，用 get_bars 计算 MA）\n2）1 分钟收盘价（盘中触发网格买卖）\n3）持仓均价（用于监控分红拆分）\n更新频率：日线数据每日一次，分钟数据每分钟。&quot;,
        &quot;stock_pool&quot;: &quot;仅对用户指定的 ETF（默认 510500）操作；未对 ST / 停牌 / 涨跌停做额外过滤，ETF 本身流动性较好，停牌概率极低。&quot;,
        &quot;buy_signals&quot;: [&quot;首次建仓：当当前价位于 60 日均价 ±20% 区间内时买入 1 份（默认 2 万元）&quot;, &quot;加仓：价格每下跌 5%（net_range）且当前层数 &lt; 最大层数时，再买入 1 份&quot;],
        &quot;sell_signals&quot;: [&quot;减仓：价格上涨到 base_price ×(1 - net_layer×5% + 10%) 以上时按公式卖出 1 份或全部&quot;, &quot;当 net_layer==1 且触发卖出条件时，清空全部仓位&quot;],
        &quot;position_and_risk&quot;: &quot;每层固定投入 g.per_share（默认 2 万元），最大层数 = 初始现金 / 每层金额；单票集中度 100%，无止损、无总仓位保护。&quot;,
        &quot;trading_frequency&quot;: &quot;handle_data 每分钟检查；若 ETF 波动频繁，一天可能多次触发买卖，否则几天甚至数周不动。&quot;,
        &quot;manual_execution_guide&quot;: &quot;若手动：\n1）盘前设定参数（net_range、per_share 等）。\n2）盘中每分钟监控价格与基准价的偏离并下单。\n3）盘后更新持仓均价，检查是否有分红拆分并调基准价。&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;否&quot;,
        &quot;risk_level&quot;: &quot;低&quot;,
        &quot;risk_score&quot;: 2,
        &quot;risk_score_reason&quot;: &quot;未使用诸如 history() / attribute_history() 等已知未来函数；get_price/get_bars 使用的是当前或过去区间，handle_data 在每分钟 bar 收盘后执行，理论上未提前看到未来数据。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;get_price(start_date = current_dt) 只返回当分钟 bar，处于 bar 结束时刻；属于允许的“用当前 bar 数据”范畴。&quot;,
            &quot;financial_data_leak&quot;: &quot;完全未用财务数据。&quot;,
            &quot;index_component_leak&quot;: &quot;无成分股筛选逻辑。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;未见利用 context.portfolio 或 order 状态进行未来信息判断。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;若担心分钟级未来价穿透，可改用当前 Tick 的 last 或上一分钟收盘价。&quot;,
        &quot;gray_area_warnings&quot;: [&quot;get_price 使用当前分钟 close 仍可能在某些回测引擎版本里等同于下一分钟可得值，请在实盘验证&quot;, &quot;大额资金时 per_share 过小会导致下单次数暴增，存在撮合性能灰区&quot;, &quot;未限制涨跌停下单，若 ETF 发生临停可能产生挂单滞留&quot;]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 2,
        &quot;slippage_reason&quot;: &quot;标的为高流动性 ETF（510500），且单笔 2 万元≈1 手以上 3 手以内，对日内中性滑点影响有限。&quot;,
        &quot;cost_score&quot;: 4,
        &quot;cost_reason&quot;: &quot;若行情波动大，每天可能 3-10 单，换手处于周-日级别；手续费设置为佣金万 3 + 千 1 印花税。&quot;,
        &quot;execution_score&quot;: 8,
        &quot;execution_reason&quot;: &quot;ETF 深市/沪市成交量充足，小额易成交；仅在极端大资金或涨跌停情形下有难度。&quot;,
        &quot;time_sensitivity_score&quot;: 6,
        &quot;time_sensitivity_reason&quot;: &quot;一分钟级触发，需要相对实时的撮合，但非毫秒级；延迟数分钟则可能错过 5%-10% 的网格节点。&quot;,
        &quot;overall_executability&quot;: 8,
        &quot;overall_reason&quot;: &quot;单票、高流动性、固定网格，技术实现简单；核心难点在参数与资金规模匹配。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;最多 5 层，撮合无压力，策略正常。&quot;,
            &quot;100w&quot;: &quot;最多 50 层；一分钟下 50 张单仍可成交，但需要考虑撮合效率与 API 限速。&quot;,
            &quot;1000w&quot;: &quot;最多 500 层；下单数量巨大，需提高 per_share 或改为批量算法，滑点与爆仓风险上升。&quot;,
            &quot;1y&quot;: &quot;≈5000 层，实盘几乎不可行；须把 per_share 提至百万级，或拆分多只 ETF。&quot;
        },
        &quot;improvement_suggestions&quot;: [&quot;动态调整 per_share 随资金规模线性放大，减少撮合次数&quot;, &quot;加入涨跌停/成交量检查，避免停牌或流动性骤降时下单失败&quot;]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 6,
        &quot;large_fund_unfriendly_reason&quot;: &quot;资金越大，层数越多且集中于单票，撮合与风控压力明显上升。&quot;,
        &quot;behavioral_bias_score&quot;: 4,
        &quot;behavioral_bias_reason&quot;: &quot;主要利用市场波动均值回归，非依赖情绪错价；对行为偏差利用有限。&quot;,
        &quot;cross_period_robustness_score&quot;: 5,
        &quot;cross_period_robustness_reason&quot;: &quot;网格策略在震荡市较好，单边趋势（尤其是持续下跌）易被套，鲁棒性中等。&quot;,
        &quot;effectiveness_total_score&quot;: 4.9,
        &quot;weight_explanation&quot;: &quot;大资金不友好 40% + 行为偏差利用 30% + 跨阶段稳健 30%&quot;,
        &quot;worst_environments&quot;: [&quot;单边下跌或上升的大趋势&quot;, &quot;低波动窄幅震荡（不足以覆盖手续费）&quot;],
        &quot;verifiable_predictions&quot;: [&quot;在 5%-10% 震荡市下，策略累计收益率将显著优于买入并持有&quot;, &quot;在月度滚动窗口下，最大回撤与上涨趋势强度正相关&quot;, &quot;加大 net_range 至 8%-10% 时，年化换手率下降、单次收益率提升&quot;]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;简单有效的小规模 ETF 网格，但对单边趋势及大资金容量有限。&quot;,
        &quot;recommendation&quot;: &quot;小仓实测&quot;,
        &quot;optimization_suggestions&quot;: &quot;（1）引入趋势过滤，在明显单边市暂停加仓；（2）per_share 与资金规模动态挂钩；（3）加入止损或时间止盈，提高资金效率。&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 2,
        &quot;slippage&quot;: 2,
        &quot;cost&quot;: 4,
        &quot;execution&quot;: 8,
        &quot;time_sensitivity&quot;: 6,
        &quot;executability&quot;: 8,
        &quot;effectiveness_a&quot;: 6,
        &quot;effectiveness_b&quot;: 4,
        &quot;effectiveness_c&quot;: 5,
        &quot;effectiveness_total&quot;: 4.9
    },
    
    &quot;assumptions&quot;: [
        &quot;未提供初始资金，默认聚宽回测 100 万元，计算 g.max_net 时以可用资金 / 2 万元。&quot;,
        &quot;使用聚宽默认滑点模型（缺失信息/你的假设）&quot;,
        &quot;订单类型默认市价委托，成交价按下一分钟撮合（缺失信息/你的假设）&quot;
    ]
}
```</pre>
        </div>

    </div>
</body>
</html>