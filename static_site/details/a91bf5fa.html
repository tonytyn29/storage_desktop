<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>月调Top5多因子ML选股 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>月调Top5多因子ML选股</h1>
        <p class="meta">
            ID: a91bf5fa | 
            类型: 多因子选股（机器学习打分 + 简单事件驱动） | 
            来源: b25_33回馈社区顺便搞积分《一个完整的机器学习pipeline》.txt |
            分析日期: 2026-01-10 22:19:53
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>用历史财务因子 + 技术指标喂给预先离线训练好的机器学习模型，对全市场（剔除科创、北交、创业板及 ST/停牌/新股/涨跌停股等）股票做横截面预测，挑出预测未来收益概率最高的前 5 只个股，每月首个交易日 9:30 等权买入；期间若持仓个股前一日涨停，则当日 14:00 观察是否封板，若炸板则立即卖出；非目标池或炸板股被卖出后，资金按等额配置至新入选股票。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>get_all_securities(date=yesterday) 得到全部 A 股，在过滤步骤中：
 - 剔除科创板(68××××)、北交(8××××)、B 股(4××××)及创业板(3××××)
 - 剔除 ST/退市标的/名称含 *
 - 剔除停牌、涨停、跌停、上市不足 375 天
 最终约 2000~3000 只股票进入打分</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>月度（run_monthly）重平衡时，模型预测概率排序 Top 5 的股票且不在当前持仓中, 卖出后如果现金仍有余额且目标股数&gt;当前持仓，则等权开仓补足</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>月度调仓时，不在最新 Top5 且前一日未涨停的持仓全部卖出, 若前一交易日涨停的持仓，今日 14:00 发现价格跌破当日涨停价，则立即卖出</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>最多持 5 只股；等权资金分配；未设置单票/组合最大回撤或持仓上限；未对行业/市值做约束；g.no_trading_today_signal 预留但未被启用。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>实际为“月度”调仓（run_monthly 每月第 1 交易日 09:30）；盘中 14:00 可能触发个别卖出；尾盘 14:30 若 g.no_trading_today_signal=True(目前不会发生) 则清仓。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>1) 盘前：无需操作（模型已离线训练）
2) 09:25-09:30 生成目标池并挂单等权买入/卖出
3) 14:00 留意前日涨停股是否炸板并择机卖出
4) 14:50 收盘前确认是否还有需平仓股票</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>显式调用 avoid_future_data=True 并使用 end_date=context.previous_date 取因子/价格，理论上避免了未来数据。但模型文件(model_baseline.pkl)在回测开始前就已加载，无法确认其是否利用了未来信息；此外 winsorize_med/standardlize 用了当期截面全部股票信息，虽常见但在严格意义上可能泄露横截面未来关系。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>model_baseline.pkl 未展示训练过程，可能含未来数据, zero-slippage 设置导致乐观收益评估, 过滤涨跌停使用 1min 数据，实盘可能出现挂单无法成交/涨停价变化</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>对小中规模资金可执行；需注意选股流动性与涨停开板时的抢跑难度。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>几万元级资金可轻松成交，不受冲击，执行成本低。</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>大概率可执行，须关注个别小票流动性及开盘挂单深度。</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>集中持 5 只股票，需精挑流动性，拆单分批成交，冲击上升，滑点显著。</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>组合容量不足，易冲高回落，成交困难，需扩容至更多标的或限制市值门槛。</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>仅持 5 只个股，且无市值/成交量过滤，可能集中于小盘股，容量有限。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>主要依赖基本面+技术因子机器学习，非情绪型策略。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>多因子+ML 有一定泛化力，但模型一旦静态不更新，滞后风险高；策略对行业/风格变化较敏感。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>极端流动性枯竭且小盘股跌停连板, 模型参数失效或财报质量失真导致预测失准</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>回测应呈现月度胜率随市场波动变化但整体&gt;50%, 模型优先选择高现金流/低估值小市值个股, 前日涨停且次日封板概率高于基准市场平均</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>月度 5 只股的机器学习多因子轮动，逻辑清晰但对小票集中、模型实时性及容量有隐患。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>1) 引入流动性/行业中性权重，增加持仓数降低单票冲击；2) 定期（如季度）重训模型并线上推新；3) 回测时加入 realistic_slippage &amp; 交易费，评估稳健性；4) 完善风险控制（止损/回撤管理）。</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>默认资金规模、成交细节、滑点模型等未在代码中给出；此处假设采用聚宽默认撮合(等价价差成交), 模型文件(model_baseline.pkl)在回测前已训练完成且未使用未来数据，但无法在代码层面验证</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>5</td></tr>
                <tr><td>滑点</td><td>4</td></tr>
                <tr><td>成本</td><td>2</td></tr>
                <tr><td>执行难度</td><td>5</td></tr>
                <tr><td>时间敏感性</td><td>3</td></tr>
                <tr><td>综合可执行性</td><td>7.3</td></tr>
                <tr><td>大资金不友好</td><td>7</td></tr>
                <tr><td>行为偏差利用</td><td>3</td></tr>
                <tr><td>跨阶段稳健性</td><td>5</td></tr>
                <tr><td>有效性总分</td><td>5.4</td></tr>
                <tr><td>总分</td><td>62.3</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;月调Top5多因子ML选股&quot;,
    &quot;strategy_type&quot;: &quot;多因子选股（机器学习打分 + 简单事件驱动）&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;用历史财务因子 + 技术指标喂给预先离线训练好的机器学习模型，对全市场（剔除科创、北交、创业板及 ST/停牌/新股/涨跌停股等）股票做横截面预测，挑出预测未来收益概率最高的前 5 只个股，每月首个交易日 9:30 等权买入；期间若持仓个股前一日涨停，则当日 14:00 观察是否封板，若炸板则立即卖出；非目标池或炸板股被卖出后，资金按等额配置至新入选股票。&quot;,
        &quot;data_and_indicators&quot;: &quot;1) jqfactor 提供的 44 个基本面 + 价格/技术指标；日频/部分高频（如 ATR、VROC 等）\n2) 价格数据：日 K、1min 收盘价、涨跌停价\n3) 行业信息（申万一级行业成份）用于缺失值填补&quot;,
        &quot;stock_pool&quot;: &quot;get_all_securities(date=yesterday) 得到全部 A 股，在过滤步骤中：\n - 剔除科创板(68××××)、北交(8××××)、B 股(4××××)及创业板(3××××)\n - 剔除 ST/退市标的/名称含 *\n - 剔除停牌、涨停、跌停、上市不足 375 天\n 最终约 2000~3000 只股票进入打分&quot;,
        &quot;buy_signals&quot;: [ 
            &quot;月度（run_monthly）重平衡时，模型预测概率排序 Top 5 的股票且不在当前持仓中&quot;, 
            &quot;卖出后如果现金仍有余额且目标股数&gt;当前持仓，则等权开仓补足&quot;
        ],
        &quot;sell_signals&quot;: [
            &quot;月度调仓时，不在最新 Top5 且前一日未涨停的持仓全部卖出&quot;,
            &quot;若前一交易日涨停的持仓，今日 14:00 发现价格跌破当日涨停价，则立即卖出&quot;
        ],
        &quot;position_and_risk&quot;: &quot;最多持 5 只股；等权资金分配；未设置单票/组合最大回撤或持仓上限；未对行业/市值做约束；g.no_trading_today_signal 预留但未被启用。&quot;,
        &quot;trading_frequency&quot;: &quot;实际为“月度”调仓（run_monthly 每月第 1 交易日 09:30）；盘中 14:00 可能触发个别卖出；尾盘 14:30 若 g.no_trading_today_signal=True(目前不会发生) 则清仓。&quot;,
        &quot;manual_execution_guide&quot;: &quot;1) 盘前：无需操作（模型已离线训练）\n2) 09:25-09:30 生成目标池并挂单等权买入/卖出\n3) 14:00 留意前日涨停股是否炸板并择机卖出\n4) 14:50 收盘前确认是否还有需平仓股票&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;不确定&quot;,
        &quot;risk_level&quot;: &quot;中&quot;,
        &quot;risk_score&quot;: 5,
        &quot;risk_score_reason&quot;: &quot;显式调用 avoid_future_data=True 并使用 end_date=context.previous_date 取因子/价格，理论上避免了未来数据。但模型文件(model_baseline.pkl)在回测开始前就已加载，无法确认其是否利用了未来信息；此外 winsorize_med/standardlize 用了当期截面全部股票信息，虽常见但在严格意义上可能泄露横截面未来关系。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;filter_limitup/down 在 09:30 使用 history(1,&#x27;1m&#x27;) 取当前交易日 09:30 的 1min 收盘价，与下单几乎同时，属于同频信号，理论上无未来泄露；可接受。&quot;,
            &quot;financial_data_leak&quot;: &quot;get_factor_values(..., end_date=yesterday) 合规；但若模型在训练时用未来收益标签则无法从代码验证。&quot;,
            &quot;index_component_leak&quot;: &quot;winsorize_med &amp; standardlize 在全截面上计算极值/均值，属于回测常见做法，可能轻微引入‘当期截面信息’但不涉及未来日期。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;无使用比如 get_fundamentals_continuously, history with lookahead&gt;0 等明显未来函数。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;1) 在回测启动时，对 model_baseline.pkl 的训练区间、使用数据范围进行核对，确保未用未来数据；2) 在线上实盘应定期滚动更新模型，仅使用已知数据；3) 若担心截面泄露，可用过去 n 日的截面均值替代当日计算的极值/标准化参数。&quot;,
        &quot;gray_area_warnings&quot;: [
            &quot;model_baseline.pkl 未展示训练过程，可能含未来数据&quot;,
            &quot;zero-slippage 设置导致乐观收益评估&quot;,
            &quot;过滤涨跌停使用 1min 数据，实盘可能出现挂单无法成交/涨停价变化&quot;
        ]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 4,
        &quot;slippage_reason&quot;: &quot;月度调仓+仅 5 只股，理论频次低；但目标可能包含小市值股票，且等权买入在 9:30 可能冲击涨停，导致 5 个值。&quot;,
        &quot;cost_score&quot;: 2,
        &quot;cost_reason&quot;: &quot;月度轮换、持股 5 只；换手率中低，对应成本压力小。&quot;,
        &quot;execution_score&quot;: 5,
        &quot;execution_reason&quot;: &quot;持仓集中度高；若选中低流动性标的，需要拆单或无法吃满；对 10~1000 万容量尚可，但 &gt;5000 万可能困难。&quot;,
        &quot;time_sensitivity_score&quot;: 3,
        &quot;time_sensitivity_reason&quot;: &quot;主要月初 9:30 执行，允差几分钟；14:00 炸板卖出具备一定时效性但只影响个别仓位。&quot;,
        &quot;overall_executability&quot;: 7,
        &quot;overall_reason&quot;: &quot;对小中规模资金可执行；需注意选股流动性与涨停开板时的抢跑难度。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;几万元级资金可轻松成交，不受冲击，执行成本低。&quot;,
            &quot;100w&quot;: &quot;大概率可执行，须关注个别小票流动性及开盘挂单深度。&quot;,
            &quot;1000w&quot;: &quot;集中持 5 只股票，需精挑流动性，拆单分批成交，冲击上升，滑点显著。&quot;,
            &quot;1y&quot;: &quot;组合容量不足，易冲高回落，成交困难，需扩容至更多标的或限制市值门槛。&quot;
        },
        &quot;improvement_suggestions&quot;: [
            &quot;提高持仓数量或加入流动性/市值权重，提升容量并分散风险&quot;,
            &quot;在回测中使用合理的成交滑点/交易费率，避免过度乐观&quot;
        ]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 7,
        &quot;large_fund_unfriendly_reason&quot;: &quot;仅持 5 只个股，且无市值/成交量过滤，可能集中于小盘股，容量有限。&quot;,
        &quot;behavioral_bias_score&quot;: 3,
        &quot;behavioral_bias_reason&quot;: &quot;主要依赖基本面+技术因子机器学习，非情绪型策略。&quot;,
        &quot;cross_period_robustness_score&quot;: 5,
        &quot;cross_period_robustness_reason&quot;: &quot;多因子+ML 有一定泛化力，但模型一旦静态不更新，滞后风险高；策略对行业/风格变化较敏感。&quot;,
        &quot;effectiveness_total_score&quot;: 4.9,
        &quot;weight_explanation&quot;: &quot;大资金不友好40% + 行为偏差30% + 稳健性30%&quot;,
        &quot;worst_environments&quot;: [
            &quot;极端流动性枯竭且小盘股跌停连板&quot;,
            &quot;模型参数失效或财报质量失真导致预测失准&quot;
        ],
        &quot;verifiable_predictions&quot;: [
            &quot;回测应呈现月度胜率随市场波动变化但整体&gt;50%&quot;,
            &quot;模型优先选择高现金流/低估值小市值个股&quot;,
            &quot;前日涨停且次日封板概率高于基准市场平均&quot;
        ]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;月度 5 只股的机器学习多因子轮动，逻辑清晰但对小票集中、模型实时性及容量有隐患。&quot;,
        &quot;recommendation&quot;: &quot;小仓实测&quot;,
        &quot;optimization_suggestions&quot;: &quot;1) 引入流动性/行业中性权重，增加持仓数降低单票冲击；2) 定期（如季度）重训模型并线上推新；3) 回测时加入 realistic_slippage &amp; 交易费，评估稳健性；4) 完善风险控制（止损/回撤管理）。&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 5,
        &quot;slippage&quot;: 4,
        &quot;cost&quot;: 2,
        &quot;execution&quot;: 5,
        &quot;time_sensitivity&quot;: 3,
        &quot;executability&quot;: 7,
        &quot;effectiveness_a&quot;: 7,
        &quot;effectiveness_b&quot;: 3,
        &quot;effectiveness_c&quot;: 5,
        &quot;effectiveness_total&quot;: 4.9
    },
    
    &quot;assumptions&quot;: [
        &quot;默认资金规模、成交细节、滑点模型等未在代码中给出；此处假设采用聚宽默认撮合(等价价差成交)&quot;,
        &quot;模型文件(model_baseline.pkl)在回测前已训练完成且未使用未来数据，但无法在代码层面验证&quot;
    ]
}
```</pre>
        </div>

    </div>
</body>
</html>