<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>周三行业ETF-BBI轮动 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>周三行业ETF-BBI轮动</h1>
        <p class="meta">
            ID: 10a4ad07 | 
            类型: 动量+趋势过滤 | 
            来源: b2324_21.行业ETF轮动+择时，15年至今年化收益35%，回撤16%.txt |
            分析日期: 2026-01-11 15:06:39
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>先用沪深300ETF的 5 日均线判断多空（牛熊过滤），若允许开仓，再判断 7 只大盘指数当日涨幅是否为正且领先；若市场可做多，则在 17 只行业指数中计算中期 BBI(21/34/55/89) 与实时价的比值，价高于 BBI（BBI/Price&lt;1）说明多头强，买入该行业对应的场内 ETF；否则全部清仓并持有银华日利货基，使亏损受限。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>仅 17 只行业 ETF（及其对应指数）+ 7 只大盘指数 + 511880 货基。用 make_sure_etf_ipo() 剔除上市不足 20 个交易日的标的。未对涨跌停、流动性做额外过滤。</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>510300ETF 价格不低于 5 日 EMA（牛市信号）, 涨幅最大的指数日内涨幅 &gt;0 且大于 5%×昨日涨幅, 对应行业 ETF 的 BBI/Price &lt;1（价格在 BBI 上方）</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>任一买入条件失效（大盘转弱或 BBI/Price≥1）, 牛熊过滤触发（510300ETF 跌破 5 日 EMA）</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>持仓仅 1 只 ETF，仓位 100%（g.position=1）；卖出后 100% 资金买入 511880。无止损/止盈；FixedSlippage 0.4%。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>run_weekly() 每周三 11:15 执行一次全部调仓；开盘 9:15 执行新股过滤。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>若人工操作：每周三 11:10~11:20 观察条件→全仓买入/卖出；若清仓则买入 511880；其余时间无需干预。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>在 intraday(11:15) 调用 get_bars(...,&#x27;1d&#x27;,include_now=True) 获取当日完整日线收盘价（行号约 102,132），在回测中相当于提前知道收盘价，构成未来函数。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>半日成交量较低的行业 ETF 可能放大冲击成本, 全部资金押单一 ETF，分散度不足, 使用货基 511880 占用全部 idle 资金需考虑折算净值误差及流动性</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>对 ≤1000 万资金较可行；更大规模需做算法交易。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>全部 ETF 均可轻松成交，冲击极低</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>流动性正常，单笔占盘面成交 &lt;5%，可直接市价</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>需分批或 VWAP，下流动性 ETF（如 159825）可能吃深度</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>部分 ETF 单日成交额不足 1 亿，无法一次完成调仓，策略容量受限</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>标的容量有限，满仓单 ETF 对资金规模敏感</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>利用动量/趋势而非纯情绪，行为溢价中等</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>单指标 (BBI) + 固定周三，可能依赖特定采样频率</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>震荡市：大盘过滤频繁切换导致来回倒腾, 单边下跌但短期急拉：牛熊判断失效被假突破诱多</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>市场明显上升周期时，所选行业 ETF 表现将显著跑赢 511880, 沪深300ETF 若长期位于 5 日均线下方，策略将保持空仓货基, 切换行业时往往伴随 BBI/Price 由&lt;1 转为&gt;1</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>理念清晰但存在严重未来函数，回测成绩高估。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>1) 去除未来函数；2) 引入多因子或多周期确认；3) 分散持仓降低单票风险</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>未提供资金规模，默认对总仓位一次性下单, 未给出滑点模型以外的交易成本，维持代码里佣金万 1.5、无印花税, 回测默认可买入所有 ETF，不考虑涨跌停及流动性约束</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>8</td></tr>
                <tr><td>滑点</td><td>4</td></tr>
                <tr><td>成本</td><td>3</td></tr>
                <tr><td>执行难度</td><td>6</td></tr>
                <tr><td>时间敏感性</td><td>4</td></tr>
                <tr><td>综合可执行性</td><td>6.7</td></tr>
                <tr><td>大资金不友好</td><td>6</td></tr>
                <tr><td>行为偏差利用</td><td>4</td></tr>
                <tr><td>跨阶段稳健性</td><td>5</td></tr>
                <tr><td>有效性总分</td><td>5.2</td></tr>
                <tr><td>总分</td><td>58.6</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;周三行业ETF-BBI轮动&quot;,
    &quot;strategy_type&quot;: &quot;动量+趋势过滤&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;先用沪深300ETF的 5 日均线判断多空（牛熊过滤），若允许开仓，再判断 7 只大盘指数当日涨幅是否为正且领先；若市场可做多，则在 17 只行业指数中计算中期 BBI(21/34/55/89) 与实时价的比值，价高于 BBI（BBI/Price&lt;1）说明多头强，买入该行业对应的场内 ETF；否则全部清仓并持有银华日利货基，使亏损受限。&quot;,
        &quot;data_and_indicators&quot;: &quot;1) 30 分钟 K 线用于 BBI；2) 日线价格用于大盘涨幅与 510300ETF 的 5 日 EMA；3) 基金、指数上市日期用于过滤；全部为行情数据，实时或日级更新。&quot;,
        &quot;stock_pool&quot;: &quot;仅 17 只行业 ETF（及其对应指数）+ 7 只大盘指数 + 511880 货基。用 make_sure_etf_ipo() 剔除上市不足 20 个交易日的标的。未对涨跌停、流动性做额外过滤。&quot;,
        &quot;buy_signals&quot;: [
            &quot;510300ETF 价格不低于 5 日 EMA（牛市信号）&quot;,
            &quot;涨幅最大的指数日内涨幅 &gt;0 且大于 5%×昨日涨幅&quot;,
            &quot;对应行业 ETF 的 BBI/Price &lt;1（价格在 BBI 上方）&quot;
        ],
        &quot;sell_signals&quot;: [
            &quot;任一买入条件失效（大盘转弱或 BBI/Price≥1）&quot;,
            &quot;牛熊过滤触发（510300ETF 跌破 5 日 EMA）&quot;
        ],
        &quot;position_and_risk&quot;: &quot;持仓仅 1 只 ETF，仓位 100%（g.position=1）；卖出后 100% 资金买入 511880。无止损/止盈；FixedSlippage 0.4%。&quot;,
        &quot;trading_frequency&quot;: &quot;run_weekly() 每周三 11:15 执行一次全部调仓；开盘 9:15 执行新股过滤。&quot;,
        &quot;manual_execution_guide&quot;: &quot;若人工操作：每周三 11:10~11:20 观察条件→全仓买入/卖出；若清仓则买入 511880；其余时间无需干预。&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;是&quot;,
        &quot;risk_level&quot;: &quot;高&quot;,
        &quot;risk_score&quot;: 8,
        &quot;risk_score_reason&quot;: &quot;在 intraday(11:15) 调用 get_bars(...,&#x27;1d&#x27;,include_now=True) 获取当日完整日线收盘价（行号约 102,132），在回测中相当于提前知道收盘价，构成未来函数。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;使用 include_now=True 读取当天 1d bar；回测时系统会返回 15:00 收盘价，而实盘 11:15 实际未知。&quot;,
            &quot;financial_data_leak&quot;: &quot;未使用财务数据，风险为无。&quot;,
            &quot;index_component_leak&quot;: &quot;无指数成分或因子未来泄漏。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;虽然 set_option(&#x27;avoid_future_data&#x27;,True)，但 include_now=True 会绕过该保护。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;将所有日线判断改为上一交易日数据（include_now=False 或 shift 1 天）；或改用分钟级实时价格而不用日线收盘。&quot;,
        &quot;gray_area_warnings&quot;: [
            &quot;半日成交量较低的行业 ETF 可能放大冲击成本&quot;,
            &quot;全部资金押单一 ETF，分散度不足&quot;,
            &quot;使用货基 511880 占用全部 idle 资金需考虑折算净值误差及流动性&quot;
        ]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 4,
        &quot;slippage_reason&quot;: &quot;场内 ETF 流动性普遍好于股票，但部分行业 ETF（如 516970）成交量有限，40bp 固定滑点略保守。&quot;,
        &quot;cost_score&quot;: 3,
        &quot;cost_reason&quot;: &quot;周换手一次；佣金万 1.5，申赎无印花税，成本低。&quot;,
        &quot;execution_score&quot;: 6,
        &quot;execution_reason&quot;: &quot;一次性砸全仓到单只 ETF；&gt;1000 万需拆单，可能冲击盘面。&quot;,
        &quot;time_sensitivity_score&quot;: 4,
        &quot;time_sensitivity_reason&quot;: &quot;固定周三 11:15，下单窗口约 10-15 分钟，时间敏感度中等。&quot;,
        &quot;overall_executability&quot;: 7,
        &quot;overall_reason&quot;: &quot;对 ≤1000 万资金较可行；更大规模需做算法交易。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;全部 ETF 均可轻松成交，冲击极低&quot;,
            &quot;100w&quot;: &quot;流动性正常，单笔占盘面成交 &lt;5%，可直接市价&quot;,
            &quot;1000w&quot;: &quot;需分批或 VWAP，下流动性 ETF（如 159825）可能吃深度&quot;,
            &quot;1y&quot;: &quot;部分 ETF 单日成交额不足 1 亿，无法一次完成调仓，策略容量受限&quot;
        },
        &quot;improvement_suggestions&quot;: [
            &quot;对低流动性 ETF 设置最大下单量限制并分批成交&quot;,
            &quot;改为持仓 2-3 只最强行业以分散冲击&quot;
        ]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 6,
        &quot;large_fund_unfriendly_reason&quot;: &quot;标的容量有限，满仓单 ETF 对资金规模敏感&quot;,
        &quot;behavioral_bias_score&quot;: 4,
        &quot;behavioral_bias_reason&quot;: &quot;利用动量/趋势而非纯情绪，行为溢价中等&quot;,
        &quot;cross_period_robustness_score&quot;: 5,
        &quot;cross_period_robustness_reason&quot;: &quot;单指标 (BBI) + 固定周三，可能依赖特定采样频率&quot;,
        &quot;effectiveness_total_score&quot;: 5.1,
        &quot;weight_explanation&quot;: &quot;大资金友好度40% + 行为偏差30% + 跨阶段稳健30%&quot;,
        &quot;worst_environments&quot;: [
            &quot;震荡市：大盘过滤频繁切换导致来回倒腾&quot;,
            &quot;单边下跌但短期急拉：牛熊判断失效被假突破诱多&quot;
        ],
        &quot;verifiable_predictions&quot;: [
            &quot;市场明显上升周期时，所选行业 ETF 表现将显著跑赢 511880&quot;,
            &quot;沪深300ETF 若长期位于 5 日均线下方，策略将保持空仓货基&quot;,
            &quot;切换行业时往往伴随 BBI/Price 由&lt;1 转为&gt;1&quot;
        ]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;理念清晰但存在严重未来函数，回测成绩高估。&quot;,
        &quot;recommendation&quot;: &quot;小仓改正未来函数后再行实测&quot;,
        &quot;optimization_suggestions&quot;: &quot;1) 去除未来函数；2) 引入多因子或多周期确认；3) 分散持仓降低单票风险&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 8,
        &quot;slippage&quot;: 4,
        &quot;cost&quot;: 3,
        &quot;execution&quot;: 6,
        &quot;time_sensitivity&quot;: 4,
        &quot;executability&quot;: 7,
        &quot;effectiveness_a&quot;: 6,
        &quot;effectiveness_b&quot;: 4,
        &quot;effectiveness_c&quot;: 5,
        &quot;effectiveness_total&quot;: 5.1
    },
    
    &quot;assumptions&quot;: [
        &quot;未提供资金规模，默认对总仓位一次性下单&quot;,
        &quot;未给出滑点模型以外的交易成本，维持代码里佣金万 1.5、无印花税&quot;,
        &quot;回测默认可买入所有 ETF，不考虑涨跌停及流动性约束&quot;
    ]
}
```</pre>
        </div>

    </div>
</body>
</html>