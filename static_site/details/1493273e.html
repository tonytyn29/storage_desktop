<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小市值低指标因子择股 + MACD指数风控 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>小市值低指标因子择股 + MACD指数风控</h1>
        <p class="meta">
            ID: 1493273e | 
            类型: 多因子选股+指数择时 | 
            来源: b2324_37.【择时模块实际效果】--论坛随便选了个策略加装.txt |
            分析日期: 2026-01-11 18:15:18
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>每天从全市场（剔除科创、北交、ST、停牌、近新股）里，寻找长期 ROA、每股留存收益、非线性市值这 3 个因子处于全市场最差 10% 且 EPS 为正、流通市值最小的股票，认为“低质量 + 小盘”存在未来估值修复；同时用中证 1000(000852) 2-4 日 EMA 生成的极短周期 DIF-DEA 作为大盘风控，一旦 &lt;0 则空仓避险。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>全 A 股（剔除 68/4*/8* 打头的科创 &amp; 北交股）→ 剔除 ST/退市标记 → 剔除停牌 → 剔除上市不足 250/125 日的新股 → 因子筛选 → 流通市值升序</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>股票在今日因子筛选后的 target_list 中, 指数风控 today_sig == 0（即 DIF ≥ DEA）</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>股票不在今日 target_list 且昨日未封涨停, 昨日封板股在 14:00 时涨停打开, 指数风控 today_sig &gt; 0 触发，全仓清空</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>最多持有 target_list 全部股票（代码中未再次裁剪，理论上&gt;10 只），等权分配现金；指数 MACD 风控为唯一系统性风控；单票满仓买入无额外止损。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>每天 9:40 调仓；14:00 特殊卖出；风控及打印信息各自定时。理论上日调仓，换手率较高。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>盘前跑一遍因子&amp;财务筛选；09:30 后观察指数 MACD；09:40 按筛选结果等权买入/卖出；14:00 观察昨日封板股是否开板并做处理；盘后记录成交及持仓。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>主要潜在风险点：get_all_securities() 未指定 date，若在回测中取用当前回测时刻则 OK，但如果聚宽引擎 bug 或未来日期提前暴露会带来成分提前暴露；其余函数均使用 context.previous_date 或历史窗，未发现明显 look-ahead。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>set_slippage(0) 回测乐观, set_order_cost 仅按千 3，未含冲击成本, minute 级别买卖停留在 9:40，实际成交价与 real_price 仍可能偏差</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>小资金可执行；大资金 &amp; 真实滑点后收益存疑。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>基本可一次性成交，资金占流动性&lt;1%，影响可忽略。</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>需要分笔，滑点 5-10bp，仍可跑。</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>大量标的日成交额&lt;3000w，需要全日 VWAP；选股 universe 容量不足。</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>几乎无法执行，大部分股票单日成交不足以吸纳仓位。</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>依赖小盘股，容量有限。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>利用的是因子错定价及规模溢价，行为偏差利用度一般。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>极短期 MACD + 单日因子重算，环境敏感；财报口径变动可能导致失效。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>小盘持续杀估值的熊市, 财务造假/黑天鹅集中爆发</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>ROA 长期处于低位的小盘股未来收益显著为正, 指数 DIF&lt;DEA 时持股收益差且回撤大, 封板次日若未开板继续持有收益更高</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>典型的小盘低质量反转 + 简单择时，思路直白但滑点/成本与未来函数风险需要修正。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>①指定 get_all_securities 日期并过滤财报发布日期；②引入流动性约束并限制最大持仓数；③采用真实滑点 &amp; 交易成本模型；④将择时周期延长至日级 MACD，减少噪声。</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>未给出资金规模，假设 &lt;1000 万, 使用聚宽默认（T+0）成交模型 + 千 3 手续费；真实交易需考虑 10bp 以上滑点</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>5</td></tr>
                <tr><td>滑点</td><td>7</td></tr>
                <tr><td>成本</td><td>7</td></tr>
                <tr><td>执行难度</td><td>5</td></tr>
                <tr><td>时间敏感性</td><td>6</td></tr>
                <tr><td>综合可执行性</td><td>4.6</td></tr>
                <tr><td>大资金不友好</td><td>8</td></tr>
                <tr><td>行为偏差利用</td><td>4</td></tr>
                <tr><td>跨阶段稳健性</td><td>4</td></tr>
                <tr><td>有效性总分</td><td>5.5</td></tr>
                <tr><td>总分</td><td>50.9</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;小市值低指标因子择股 + MACD指数风控&quot;,
    &quot;strategy_type&quot;: &quot;多因子选股+指数择时&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;每天从全市场（剔除科创、北交、ST、停牌、近新股）里，寻找长期 ROA、每股留存收益、非线性市值这 3 个因子处于全市场最差 10% 且 EPS 为正、流通市值最小的股票，认为“低质量 + 小盘”存在未来估值修复；同时用中证 1000(000852) 2-4 日 EMA 生成的极短周期 DIF-DEA 作为大盘风控，一旦 &lt;0 则空仓避险。&quot;,
        &quot;data_and_indicators&quot;: &quot;①价格：分钟、日线；②财务因子：roa_ttm_8y、retained_earnings_per_share、non_linear_size、eps；③指数价格：000852 日线；④涨跌停价、停牌状态；更新频率：财务按日拉取上一日值，其余分钟或日内实时。&quot;,
        &quot;stock_pool&quot;: &quot;全 A 股（剔除 68/4*/8* 打头的科创 &amp; 北交股）→ 剔除 ST/退市标记 → 剔除停牌 → 剔除上市不足 250/125 日的新股 → 因子筛选 → 流通市值升序&quot;,
        &quot;buy_signals&quot;: [&quot;股票在今日因子筛选后的 target_list 中&quot;, &quot;指数风控 today_sig == 0（即 DIF ≥ DEA）&quot;],
        &quot;sell_signals&quot;: [&quot;股票不在今日 target_list 且昨日未封涨停&quot;, &quot;昨日封板股在 14:00 时涨停打开&quot;, &quot;指数风控 today_sig &gt; 0 触发，全仓清空&quot;],
        &quot;position_and_risk&quot;: &quot;最多持有 target_list 全部股票（代码中未再次裁剪，理论上&gt;10 只），等权分配现金；指数 MACD 风控为唯一系统性风控；单票满仓买入无额外止损。&quot;,
        &quot;trading_frequency&quot;: &quot;每天 9:40 调仓；14:00 特殊卖出；风控及打印信息各自定时。理论上日调仓，换手率较高。&quot;,
        &quot;manual_execution_guide&quot;: &quot;盘前跑一遍因子&amp;财务筛选；09:30 后观察指数 MACD；09:40 按筛选结果等权买入/卖出；14:00 观察昨日封板股是否开板并做处理；盘后记录成交及持仓。&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;不确定&quot;,
        &quot;risk_level&quot;: &quot;中&quot;,
        &quot;risk_score&quot;: 5,
        &quot;risk_score_reason&quot;: &quot;主要潜在风险点：get_all_securities() 未指定 date，若在回测中取用当前回测时刻则 OK，但如果聚宽引擎 bug 或未来日期提前暴露会带来成分提前暴露；其余函数均使用 context.previous_date 或历史窗，未发现明显 look-ahead。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;所有 get_price / history 均以 end_date ≤ 当前或 previous_date，未见超前引用。&quot;,
            &quot;financial_data_leak&quot;: &quot;get_factor_values / get_fundamentals 均使用 yesterday，上市公司财报真实可得性依赖聚宽实现，理论风险中等。&quot;,
            &quot;index_component_leak&quot;: &quot;未使用未来指数成分，仅用指数价格。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;未使用 run_monthly / before_trading 等跨日同步函数，同时自设 set_slippage(0) 会在回测中高估收益。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;在 get_all_securities(types=[], date=context.previous_date) 显式指定日期；为财务数据增加财报公布日过滤；设置真实滑点模型。&quot;,
        &quot;gray_area_warnings&quot;: [&quot;set_slippage(0) 回测乐观&quot;, &quot;set_order_cost 仅按千 3，未含冲击成本&quot;, &quot;minute 级别买卖停留在 9:40，实际成交价与 real_price 仍可能偏差&quot;]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 7,
        &quot;slippage_reason&quot;: &quot;主要买小市值股，且 9:40 集中下单，冲击明显；代码假设 0 滑点。&quot;,
        &quot;cost_score&quot;: 7,
        &quot;cost_reason&quot;: &quot;日调仓、等权买入，换手率高；成本&gt;千 3 + 滑点。&quot;,
        &quot;execution_score&quot;: 5,
        &quot;execution_reason&quot;: &quot;标的多为小盘股，10-1000 万资金尚可拆单成交；&gt;5000 万则难。&quot;,
        &quot;time_sensitivity_score&quot;: 6,
        &quot;time_sensitivity_reason&quot;: &quot;需 9:40 当下价格调仓，延迟 5-10 分钟会引发偏差；但非高频。&quot;,
        &quot;overall_executability&quot;: 5,
        &quot;overall_reason&quot;: &quot;小资金可执行；大资金 &amp; 真实滑点后收益存疑。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;基本可一次性成交，资金占流动性&lt;1%，影响可忽略。&quot;,
            &quot;100w&quot;: &quot;需要分笔，滑点 5-10bp，仍可跑。&quot;,
            &quot;1000w&quot;: &quot;大量标的日成交额&lt;3000w，需要全日 VWAP；选股 universe 容量不足。&quot;,
            &quot;1y&quot;: &quot;几乎无法执行，大部分股票单日成交不足以吸纳仓位。&quot;
        },
        &quot;improvement_suggestions&quot;: [&quot;加入成交额/换手率过滤&quot;, &quot;把调仓频率改为周/月，降低换手&quot;]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 8,
        &quot;large_fund_unfriendly_reason&quot;: &quot;依赖小盘股，容量有限。&quot;,
        &quot;behavioral_bias_score&quot;: 4,
        &quot;behavioral_bias_reason&quot;: &quot;利用的是因子错定价及规模溢价，行为偏差利用度一般。&quot;,
        &quot;cross_period_robustness_score&quot;: 4,
        &quot;cross_period_robustness_reason&quot;: &quot;极短期 MACD + 单日因子重算，环境敏感；财报口径变动可能导致失效。&quot;,
        &quot;effectiveness_total_score&quot;: 4.9,
        &quot;weight_explanation&quot;: &quot;大资金不友好40%+非理性30%+跨阶段稳健30%&quot;,
        &quot;worst_environments&quot;: [&quot;小盘持续杀估值的熊市&quot;, &quot;财务造假/黑天鹅集中爆发&quot;],
        &quot;verifiable_predictions&quot;: [&quot;ROA 长期处于低位的小盘股未来收益显著为正&quot;, &quot;指数 DIF&lt;DEA 时持股收益差且回撤大&quot;, &quot;封板次日若未开板继续持有收益更高&quot;]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;典型的小盘低质量反转 + 简单择时，思路直白但滑点/成本与未来函数风险需要修正。&quot;,
        &quot;recommendation&quot;: &quot;小仓实测&quot;,
        &quot;optimization_suggestions&quot;: &quot;①指定 get_all_securities 日期并过滤财报发布日期；②引入流动性约束并限制最大持仓数；③采用真实滑点 &amp; 交易成本模型；④将择时周期延长至日级 MACD，减少噪声。&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 5,
        &quot;slippage&quot;: 7,
        &quot;cost&quot;: 7,
        &quot;execution&quot;: 5,
        &quot;time_sensitivity&quot;: 6,
        &quot;executability&quot;: 5,
        &quot;effectiveness_a&quot;: 8,
        &quot;effectiveness_b&quot;: 4,
        &quot;effectiveness_c&quot;: 4,
        &quot;effectiveness_total&quot;: 4.9
    },
    
    &quot;assumptions&quot;: [&quot;未给出资金规模，假设 &lt;1000 万&quot;, &quot;使用聚宽默认（T+0）成交模型 + 千 3 手续费；真实交易需考虑 10bp 以上滑点&quot;]
}
```</pre>
        </div>

    </div>
</body>
</html>