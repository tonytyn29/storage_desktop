<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IF三价均线+ATR日内趋势 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>IF三价均线+ATR日内趋势</h1>
        <p class="meta">
            ID: 9db9400d | 
            类型: 趋势跟踪 | 
            来源: b2324_71.期货日内策略三价均线结合ATR指标.txt |
            分析日期: 2026-01-11 18:26:44
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>只做日内。先用最近 2 个自然日的收盘动量决定当日只做多还是只做空；盘中（10:00-14:59）在 1 分钟级别上，用 5 分钟三价均线(高+低+收)/3 上穿 / 下穿 20 分钟三价均线且 20 线保持单调向上/向下时入场，持仓期间当快线反向死亡交叉或快慢线距离大于 3×ATR 就止盈/止损；14:59 一律平仓，不隔夜。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>仅股指期货 IF（通过 get_dominant_future 获取主力合约）；无其他过滤。</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>当日 signal_long=True（前 2 日动量为正）, 20MA 最近 4 点严格递增 + 5MA 自下向上金叉 20MA</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>持多仓时：5MA 自上向下死叉 20MA, 或 5MA-20MA &gt; 3×ATR, 14:59 强制平仓；空头逻辑同理</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>每次 order_value(context.portfolio.available_cash) 全仓（大约 6.7× 杠杆，因保证金率 15%）；无分仓；ATR 仅用于止损；未设资金/隔夜风控。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>0-2 次/日（进场一次、14:59 出场一次）；下单发生在 run_daily(market_open, time=&#x27;every_bar&#x27;) 的 1 分钟回调。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>盘前 09:00 读取主力合约并确定当日方向；10:00-14:58 监控 1 分钟数据满足条件即以市价开平仓；14:59 平仓；盘后查看成交。实盘若手动，可在文华/CTP 下市价单。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>所有 get_price 调用都使用 end_date=context.previous_date 或 当前时间-1 分钟，未引用未来价格；无因子在当日收盘后再计算用于当日交易。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>g.main_symbol 只在 09:00 更新，当天若临近交割换月价差突变可能被动滑点, 全仓开仓且杠杆≈6.7，无强平逻辑，实盘可能触发保证金追缴, 仅用 4 个 1 分钟点判断趋势，噪声大，回测超额收益可能依赖滑点假设</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>高流动性合约 + 低频入场 + 简单逻辑；只需分钟级调度。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>保证金约 1.5w；1 手 IF 足够，滑点可忽略。</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>约 15w 保证金，5-6 手；仍毫无压力。</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>≈ 50-60 手；占主力日成交 &lt;1%，可行但要关注冲击。</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>需 500-600 手，约 1%-3% 分钟量；需要算法拆单，仍可执行。</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>股指期货容量大；1000w 资金也只占流动性小头。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>简单动量/趋势信号，对投资者情绪并无精细捕捉。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>趋势策略对震荡日脆弱，但不依赖单一行情；长期有一定稳健性。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>窄幅震荡、无趋势的日内行情, 宏观突发导致价格跳空但随后横盘</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>当 5MA 向上金叉且 20MA 单调上升时，IF 当分钟后 30-60 分钟趋势概率提升, 2 日动量方向错误时持仓为 0, 14:59 收盘前平仓，日内无隔夜收益贡献</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>简洁的日内趋势跟踪策略，在 IF 主力合约上易于执行、未来函数风险低，但资金管理粗放且依赖 1min 噪声。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>加入分级仓位与实时多合约切换，增加波动率调整及日内止盈止损分层。</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>回测与实盘均使用恒久可用的 1 分钟深度行情，且系统无 1 分钟级网络延迟, 未给出初始资金、滑点模型参数解释，默认按聚宽 IF 主力典型流动性估算</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>2</td></tr>
                <tr><td>滑点</td><td>3</td></tr>
                <tr><td>成本</td><td>3</td></tr>
                <tr><td>执行难度</td><td>2</td></tr>
                <tr><td>时间敏感性</td><td>6</td></tr>
                <tr><td>综合可执行性</td><td>7.9</td></tr>
                <tr><td>大资金不友好</td><td>2</td></tr>
                <tr><td>行为偏差利用</td><td>3</td></tr>
                <tr><td>跨阶段稳健性</td><td>5</td></tr>
                <tr><td>有效性总分</td><td>3.5</td></tr>
                <tr><td>总分</td><td>55.2</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;IF三价均线+ATR日内趋势&quot;,
    &quot;strategy_type&quot;: &quot;趋势跟踪&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;只做日内。先用最近 2 个自然日的收盘动量决定当日只做多还是只做空；盘中（10:00-14:59）在 1 分钟级别上，用 5 分钟三价均线(高+低+收)/3 上穿 / 下穿 20 分钟三价均线且 20 线保持单调向上/向下时入场，持仓期间当快线反向死亡交叉或快慢线距离大于 3×ATR 就止盈/止损；14:59 一律平仓，不隔夜。&quot;,
        &quot;data_and_indicators&quot;: &quot;1m K 线的 high/low/close（用于三价 MA、ATR）、1d 级 close（用于 2 日动量）。指标刷新频率：1 分钟。&quot;,
        &quot;stock_pool&quot;: &quot;仅股指期货 IF（通过 get_dominant_future 获取主力合约）；无其他过滤。&quot;,
        &quot;buy_signals&quot;: [&quot;当日 signal_long=True（前 2 日动量为正）&quot;, &quot;20MA 最近 4 点严格递增 + 5MA 自下向上金叉 20MA&quot;],
        &quot;sell_signals&quot;: [&quot;持多仓时：5MA 自上向下死叉 20MA&quot;, &quot;或 5MA-20MA &gt; 3×ATR&quot;, &quot;14:59 强制平仓；空头逻辑同理&quot;],
        &quot;position_and_risk&quot;: &quot;每次 order_value(context.portfolio.available_cash) 全仓（大约 6.7× 杠杆，因保证金率 15%）；无分仓；ATR 仅用于止损；未设资金/隔夜风控。&quot;,
        &quot;trading_frequency&quot;: &quot;0-2 次/日（进场一次、14:59 出场一次）；下单发生在 run_daily(market_open, time=&#x27;every_bar&#x27;) 的 1 分钟回调。&quot;,
        &quot;manual_execution_guide&quot;: &quot;盘前 09:00 读取主力合约并确定当日方向；10:00-14:58 监控 1 分钟数据满足条件即以市价开平仓；14:59 平仓；盘后查看成交。实盘若手动，可在文华/CTP 下市价单。&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;否&quot;,
        &quot;risk_level&quot;: &quot;低&quot;,
        &quot;risk_score&quot;: 2,
        &quot;risk_score_reason&quot;: &quot;所有 get_price 调用都使用 end_date=context.previous_date 或 当前时间-1 分钟，未引用未来价格；无因子在当日收盘后再计算用于当日交易。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;get_ma / get_atr 均以 dt_lastMinute 作为 end_date，确保不含当前 bar 之后的数据。&quot;,
            &quot;financial_data_leak&quot;: &quot;策略不涉及财务数据。&quot;,
            &quot;index_component_leak&quot;: &quot;无成分表调用。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;无使用回测器已知涨跌停/成交量进行跨时空判断。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;理论上已安全；为了严谨也可把 end_date 精确到 context.current_dt.replace(second=0,microsecond=0)-timedelta(minutes=1)。&quot;,
        &quot;gray_area_warnings&quot;: [
            &quot;g.main_symbol 只在 09:00 更新，当天若临近交割换月价差突变可能被动滑点&quot;,
            &quot;全仓开仓且杠杆≈6.7，无强平逻辑，实盘可能触发保证金追缴&quot;,
            &quot;仅用 4 个 1 分钟点判断趋势，噪声大，回测超额收益可能依赖滑点假设&quot;
        ]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 3,
        &quot;slippage_reason&quot;: &quot;IF 主力日均成交 &gt; 10 万手，1min 市价滑点约 0-1 跳；代码模型 StepRelatedSlippage(2) 基本覆盖。&quot;,
        &quot;cost_score&quot;: 3,
        &quot;cost_reason&quot;: &quot;手续费总计双边约 0.00018；每日 2-4 单；年化换手较低。&quot;,
        &quot;execution_score&quot;: 2,
        &quot;execution_reason&quot;: &quot;市价+高流动性期货，成交极易；无分批或冰山需求。&quot;,
        &quot;time_sensitivity_score&quot;: 6,
        &quot;time_sensitivity_reason&quot;: &quot;信号基于 1min 数据，需准时触发；但容忍 1-2 秒误差。&quot;,
        &quot;overall_executability&quot;: 8,
        &quot;overall_reason&quot;: &quot;高流动性合约 + 低频入场 + 简单逻辑；只需分钟级调度。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;保证金约 1.5w；1 手 IF 足够，滑点可忽略。&quot;,
            &quot;100w&quot;: &quot;约 15w 保证金，5-6 手；仍毫无压力。&quot;,
            &quot;1000w&quot;: &quot;≈ 50-60 手；占主力日成交 &lt;1%，可行但要关注冲击。&quot;,
            &quot;1y&quot;: &quot;需 500-600 手，约 1%-3% 分钟量；需要算法拆单，仍可执行。&quot;
        },
        &quot;improvement_suggestions&quot;: [
            &quot;动态调整开仓手数而非 all-in，可降低保证金风险&quot;,
            &quot;在 14:45 前启动逐笔减仓，减轻 14:59 最后一笔的集中冲击&quot;
        ]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 2,
        &quot;large_fund_unfriendly_reason&quot;: &quot;股指期货容量大；1000w 资金也只占流动性小头。&quot;,
        &quot;behavioral_bias_score&quot;: 3,
        &quot;behavioral_bias_reason&quot;: &quot;简单动量/趋势信号，对投资者情绪并无精细捕捉。&quot;,
        &quot;cross_period_robustness_score&quot;: 5,
        &quot;cross_period_robustness_reason&quot;: &quot;趋势策略对震荡日脆弱，但不依赖单一行情；长期有一定稳健性。&quot;,
        &quot;effectiveness_total_score&quot;: 3.5,
        &quot;weight_explanation&quot;: &quot;大资金友好30% + 行为利用30% + 跨阶段稳健40%&quot;,
        &quot;worst_environments&quot;: [&quot;窄幅震荡、无趋势的日内行情&quot;, &quot;宏观突发导致价格跳空但随后横盘&quot;],
        &quot;verifiable_predictions&quot;: [
            &quot;当 5MA 向上金叉且 20MA 单调上升时，IF 当分钟后 30-60 分钟趋势概率提升&quot;,
            &quot;2 日动量方向错误时持仓为 0&quot;,
            &quot;14:59 收盘前平仓，日内无隔夜收益贡献&quot;
        ]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;简洁的日内趋势跟踪策略，在 IF 主力合约上易于执行、未来函数风险低，但资金管理粗放且依赖 1min 噪声。&quot;,
        &quot;recommendation&quot;: &quot;小仓实测&quot;,
        &quot;optimization_suggestions&quot;: &quot;加入分级仓位与实时多合约切换，增加波动率调整及日内止盈止损分层。&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 2,
        &quot;slippage&quot;: 3,
        &quot;cost&quot;: 3,
        &quot;execution&quot;: 2,
        &quot;time_sensitivity&quot;: 6,
        &quot;executability&quot;: 8,
        &quot;effectiveness_a&quot;: 2,
        &quot;effectiveness_b&quot;: 3,
        &quot;effectiveness_c&quot;: 5,
        &quot;effectiveness_total&quot;: 3.5
    },
    
    &quot;assumptions&quot;: [
        &quot;回测与实盘均使用恒久可用的 1 分钟深度行情，且系统无 1 分钟级网络延迟&quot;,
        &quot;未给出初始资金、滑点模型参数解释，默认按聚宽 IF 主力典型流动性估算&quot;
    ]
}
```</pre>
        </div>

    </div>
</body>
</html>