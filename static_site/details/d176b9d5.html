<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大小盘风格切换多因子月度轮动 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>大小盘风格切换多因子月度轮动</h1>
        <p class="meta">
            ID: d176b9d5 | 
            类型: 动量+多因子选股 | 
            来源: b2324_27.根据大小盘相对强弱选择合适的板块股票进行交易.txt |
            分析日期: 2026-01-11 18:12:24
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>先用近89日大小盘指数（上证50 vs. 国证2000）的动量得分选择当前市场主导风格；若大盘占优则做10 只大盘价值成长股，若小盘占优则做最多 30 只小盘高增长股。每月先在倒数第 10 个交易日 11:00 清仓/止损，再在月末最后 1 个交易日 11:15 建仓。仓位在同组股票内按改进的等权（稍微给排名靠前的更高权）并用“50 日均价 Z 分”做轻微价差调整。赚钱逻辑：趋势跟踪切换风格 + 截面多因子赚因子溢价。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>先全部 A 股→去掉科创板、ST/*ST/退、市值&lt;3 年新股、当日一字涨跌停、停牌股→按风格子集进一步财务/市值过滤。</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>风格判断为大盘：通过 7 级财务过滤后的 PB 最低前 g.stock_num 只；, 风格判断为小盘：满足成长/现金流约束后按市值从小到大取前 g.stock_num_small 只。</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>定期：每月倒数第 10 个交易日 11:00 对当前不在新池子的持仓全部清仓；, 止损：大盘股跌破建仓价-15%，小盘股跌破建仓价-5%；, 止盈回撤：浮盈≥30% 且从最高价回撤≥5% 时减 80% 仓。</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>目标总仓=100%；大盘模式最大 10 只、单票≈10%；小盘模式最多 30 只、单票≈3.3%；仓位因 50 日 Z 分进行 0.5–1.5 倍微调。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>月度两次（卖 + 买）；盘中 11:00/11:15 下单。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>盘前不用操作；每月倒数第 10 个交易日 10:55 生成卖出池并 11:00 下单；月末最后交易日 11:10 生成买入池并 11:15 下单即可。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>已 set_option(&#x27;avoid_future_data&#x27;,True)。所有 get_fundamentals / get_history_fundamentals 均使用 context.previous_date，价格函数未使用未来索引。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>11:15 用当日尚未收盘的价格选股，极端脉冲行情下可能与收盘价差异大。, 次新股过滤通过 get_all_securities(date=1200 天前) 实际仍可能留下不足 3 年但足够老的转板标的。, 大盘/小盘止损阈值固定，未考虑波动率变动，可能在极端行情下失灵。</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>中小资金可行，需对小盘股流动性做额外检查。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>完全可行，滑点可忽略。</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>可行，可能需要分拆下单。</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>需剔除最小市值股票，否则冲击成本明显。</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>大概率无法全量跟踪小盘组合，需做容量控制或只跑大盘策略。</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>小盘 30 只低市值股对大资金不友好。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>收益主要来自基本面因子与动量，利用情绪有限。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>动量切换 + 多因子思路有一定跨期鲁棒，但阈值/窗口均硬编码。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>大小盘风格交替频繁、无明显主线的震荡市, 财报频繁爆雷、基本面因子失灵的极端信用收缩期</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>当上证50 3 个月动量 &gt; 国证 2000 时，价值组合未来月度超额收益为正。, 小盘模式时期，组合相对中证 2000 指数的贝塔高于大盘模式时期。, 组合换手率与收益正相关但边际递减。</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>逻辑完整且未来数据泄漏风险低，适合中小资金做月度轮动，但小盘端容量与滑点需重点关注。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>动态调节仓位数量+流动性过滤、采用分段交易算法、引入风险模型平滑风格切换。</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>资金规模未给出，以上场景按人民币计价假设。, 回测默认使用聚宽模拟撮合，滑点模型固定 0.02 元已在代码中给出；实际成交差异需另行评估。</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>3</td></tr>
                <tr><td>滑点</td><td>5</td></tr>
                <tr><td>成本</td><td>3</td></tr>
                <tr><td>执行难度</td><td>5</td></tr>
                <tr><td>时间敏感性</td><td>3</td></tr>
                <tr><td>综合可执行性</td><td>6.7</td></tr>
                <tr><td>大资金不友好</td><td>6</td></tr>
                <tr><td>行为偏差利用</td><td>4</td></tr>
                <tr><td>跨阶段稳健性</td><td>5</td></tr>
                <tr><td>有效性总分</td><td>5.2</td></tr>
                <tr><td>总分</td><td>58.5</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;大小盘风格切换多因子月度轮动&quot;,
    &quot;strategy_type&quot;: &quot;动量+多因子选股&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;先用近89日大小盘指数（上证50 vs. 国证2000）的动量得分选择当前市场主导风格；若大盘占优则做10 只大盘价值成长股，若小盘占优则做最多 30 只小盘高增长股。每月先在倒数第 10 个交易日 11:00 清仓/止损，再在月末最后 1 个交易日 11:15 建仓。仓位在同组股票内按改进的等权（稍微给排名靠前的更高权）并用“50 日均价 Z 分”做轻微价差调整。赚钱逻辑：趋势跟踪切换风格 + 截面多因子赚因子溢价。&quot;,
        &quot;data_and_indicators&quot;: &quot;价格：指数/个股日线 high、low、open、close（实时 11 点取数）；财务：流通市值、市净率、ROE、现金流、营业利润、净利润等（上一交易日披露值）；因子更新频率：价格日更，财务季更。&quot;,
        &quot;stock_pool&quot;: &quot;先全部 A 股→去掉科创板、ST/*ST/退、市值&lt;3 年新股、当日一字涨跌停、停牌股→按风格子集进一步财务/市值过滤。&quot;,
        &quot;buy_signals&quot;: [
            &quot;风格判断为大盘：通过 7 级财务过滤后的 PB 最低前 g.stock_num 只；&quot;,
            &quot;风格判断为小盘：满足成长/现金流约束后按市值从小到大取前 g.stock_num_small 只。&quot;
        ],
        &quot;sell_signals&quot;: [
            &quot;定期：每月倒数第 10 个交易日 11:00 对当前不在新池子的持仓全部清仓；&quot;,
            &quot;止损：大盘股跌破建仓价-15%，小盘股跌破建仓价-5%；&quot;,
            &quot;止盈回撤：浮盈≥30% 且从最高价回撤≥5% 时减 80% 仓。&quot;
        ],
        &quot;position_and_risk&quot;: &quot;目标总仓=100%；大盘模式最大 10 只、单票≈10%；小盘模式最多 30 只、单票≈3.3%；仓位因 50 日 Z 分进行 0.5–1.5 倍微调。&quot;,
        &quot;trading_frequency&quot;: &quot;月度两次（卖 + 买）；盘中 11:00/11:15 下单。&quot;,
        &quot;manual_execution_guide&quot;: &quot;盘前不用操作；每月倒数第 10 个交易日 10:55 生成卖出池并 11:00 下单；月末最后交易日 11:10 生成买入池并 11:15 下单即可。&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;否&quot;,
        &quot;risk_level&quot;: &quot;低&quot;,
        &quot;risk_score&quot;: 3,
        &quot;risk_score_reason&quot;: &quot;已 set_option(&#x27;avoid_future_data&#x27;,True)。所有 get_fundamentals / get_history_fundamentals 均使用 context.previous_date，价格函数未使用未来索引。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;attribute_history 与 get_bars 均 &lt;= 当前时点，include_now 只含当日已产生数据，无未来价格。&quot;,
            &quot;financial_data_leak&quot;: &quot;watch_date=context.previous_date，joinquant 自动按披露日期过滤，风险较低。&quot;,
            &quot;index_component_leak&quot;: &quot;未使用未来指数成分，仅用指数行情。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;无自写缓存/回测日期偏置。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;如需更保险，可在 get_bars 中改为 include_now=False。&quot;,
        &quot;gray_area_warnings&quot;: [
            &quot;11:15 用当日尚未收盘的价格选股，极端脉冲行情下可能与收盘价差异大。&quot;,
            &quot;次新股过滤通过 get_all_securities(date=1200 天前) 实际仍可能留下不足 3 年但足够老的转板标的。&quot;,
            &quot;大盘/小盘止损阈值固定，未考虑波动率变动，可能在极端行情下失灵。&quot;
        ]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 5,
        &quot;slippage_reason&quot;: &quot;小盘模式含 30 只低市值股，11 点成交量不高；采用市价 order_value 可能产生 1% 级别滑点。&quot;,
        &quot;cost_score&quot;: 3,
        &quot;cost_reason&quot;: &quot;月度调仓，两次换手；成本主要来自进出费率（代码中假设千 0.5）+ 滑点。&quot;,
        &quot;execution_score&quot;: 5,
        &quot;execution_reason&quot;: &quot;分散下单且资金&lt;1000 万基本可成交；大于 1 亿时部分小盘股流动性不足。&quot;,
        &quot;time_sensitivity_score&quot;: 3,
        &quot;time_sensitivity_reason&quot;: &quot;仅需在 11 点附近成交，分钟级即可。&quot;,
        &quot;overall_executability&quot;: 6,
        &quot;overall_reason&quot;: &quot;中小资金可行，需对小盘股流动性做额外检查。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;完全可行，滑点可忽略。&quot;,
            &quot;100w&quot;: &quot;可行，可能需要分拆下单。&quot;,
            &quot;1000w&quot;: &quot;需剔除最小市值股票，否则冲击成本明显。&quot;,
            &quot;1y&quot;: &quot;大概率无法全量跟踪小盘组合，需做容量控制或只跑大盘策略。&quot;
        },
        &quot;improvement_suggestions&quot;: [
            &quot;对小盘模式设置最低日成交额过滤（如 3000 万元）；&quot;,
            &quot;将买卖拆分为 VWAP 或 TWAP 以降低冲击。&quot;
        ]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 6,
        &quot;large_fund_unfriendly_reason&quot;: &quot;小盘 30 只低市值股对大资金不友好。&quot;,
        &quot;behavioral_bias_score&quot;: 4,
        &quot;behavioral_bias_reason&quot;: &quot;收益主要来自基本面因子与动量，利用情绪有限。&quot;,
        &quot;cross_period_robustness_score&quot;: 5,
        &quot;cross_period_robustness_reason&quot;: &quot;动量切换 + 多因子思路有一定跨期鲁棒，但阈值/窗口均硬编码。&quot;,
        &quot;effectiveness_total_score&quot;: 5.0,
        &quot;weight_explanation&quot;: &quot;大资金不友好40% + 行为利用30% + 跨阶段稳健30%&quot;,
        &quot;worst_environments&quot;: [
            &quot;大小盘风格交替频繁、无明显主线的震荡市&quot;,
            &quot;财报频繁爆雷、基本面因子失灵的极端信用收缩期&quot;
        ],
        &quot;verifiable_predictions&quot;: [
            &quot;当上证50 3 个月动量 &gt; 国证 2000 时，价值组合未来月度超额收益为正。&quot;,
            &quot;小盘模式时期，组合相对中证 2000 指数的贝塔高于大盘模式时期。&quot;,
            &quot;组合换手率与收益正相关但边际递减。&quot;
        ]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;逻辑完整且未来数据泄漏风险低，适合中小资金做月度轮动，但小盘端容量与滑点需重点关注。&quot;,
        &quot;recommendation&quot;: &quot;小仓实测&quot;,
        &quot;optimization_suggestions&quot;: &quot;动态调节仓位数量+流动性过滤、采用分段交易算法、引入风险模型平滑风格切换。&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 3,
        &quot;slippage&quot;: 5,
        &quot;cost&quot;: 3,
        &quot;execution&quot;: 5,
        &quot;time_sensitivity&quot;: 3,
        &quot;executability&quot;: 6,
        &quot;effectiveness_a&quot;: 6,
        &quot;effectiveness_b&quot;: 4,
        &quot;effectiveness_c&quot;: 5,
        &quot;effectiveness_total&quot;: 5.0
    },
    
    &quot;assumptions&quot;: [
        &quot;资金规模未给出，以上场景按人民币计价假设。&quot;,
        &quot;回测默认使用聚宽模拟撮合，滑点模型固定 0.02 元已在代码中给出；实际成交差异需另行评估。&quot;
    ]
}
```</pre>
        </div>

    </div>
</body>
</html>