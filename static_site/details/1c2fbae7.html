<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicroCap-LargeCap CUSUM-ML 5日择时 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>MicroCap-LargeCap CUSUM-ML 5日择时</h1>
        <p class="meta">
            ID: 1c2fbae7 | 
            类型: 小市值轮动 + 统计套利/趋势判断 | 
            来源: b2324_94.大市值小市值今年的一些分析，然后尝试预测小市值行情.txt |
            分析日期: 2026-01-11 18:34:17
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>先把同一指数成份股按当下流通市值从小到大切成『微盘股组』（最小200 只）与『大盘股组』（最大200 只），将各组日行情简单求和构造两条“伪指数”。对两条序列做：(1) CUSUM 检测拐点，记录过去买卖次数；(2) 计算 5 日窗口涨跌幅统计并把大小盘的统计量拼接成特征；(3) 用 XGBoost 回归拟合“微盘股指数”的点位，并外推未来 5 个交易日。根据回测段微盘指数 + 预测段 5 日序列再次跑 CUSUM，若出现上拐点给出买入信号，出现下拐点给出卖出信号。赚钱来源假设为：在大小盘风格切换时，及时切入（或撤离）高 β 的微盘股组以博取超额收益，并利用大小盘回归关系进行对冲。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>以 000985.XSHG 指数成份为基础，排除代码前缀 3/68/4/8，过滤 ST、停牌、新上市≤365 天及退市个股；再按『当前时点』流通市值升序切分头尾各 200 只做大小盘组合；并要求 eps&gt;0。</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>CUSUM 算法检测到微盘指数向上突破（S_h 超阈值）, 未来 5 日 ML 预测序列亦出现上拐点</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>CUSUM 检测到微盘指数向下突破（S_l 超阈值）, 未来 5 日 ML 预测序列出现下拐点</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>代码中未给出任何持仓/权重/止损控制。
缺失信息/你的假设：若实盘执行需等权买入 200 只微盘股并用对冲比例 slope 卖空大盘 ETF 或指数期货降低 β。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>CUSUM+预测信号一旦触发即调仓，理论上≈日级检查，实际频率取决于拐点出现次数。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>仅提供研究脚本，未嵌入 initialize/handle_data。若人工执行，可在收盘后跑脚本-&gt;第二个交易日上午集合竞价完成买卖。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>stock_pool 构造使用 get_stock(&#x27;AA&#x27;, current_time) 以及 get_fundamentals(..., end_date=current_time) —— 以今天流通市值与 EPS 静态划分 2023-01-01 至今的股票池，属于典型『成份股前视』；CUSUM/特征滑窗亦在训练阶段使用全样本均值方差，无时间切分。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>CUSUM 阈值 0.1×std 极低，信号易噪声过度交易, 指数用简单求和未做市值或数量归一化，尺度漂移大, XGBoost 训练未做时间序列验证，容易过拟合</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>仅适合 ≤500 万规模试验，需工程化批量交易与 TCA。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>流动性充裕，可手动/市价完成。</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>需分批 + 低冲击原则，仍可执行。</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>微盘股组合成交量不足，被动吃掉 5%+ 深度，滑点失控。</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>不可行，需改用 ETF 或指数期货实现风格轮动。</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>微盘股容量极低且持仓分散 200 只，资金越大越难进出。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>策略主要依赖大小盘风格切换，未明显利用情绪/行为偏差。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>参数、股票池前视严重，缺少滚动验证，跨周期稳健性存疑。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>微盘股整体流动性枯竭/连板跌停, 大小盘同跌的系统性风险</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>未来 5 个交易日微盘指数涨跌方向由脚本给出, 大小盘涨跌幅回归系数 slope≈1 是否长期稳定, CUSUM 信号触发后 10 日期望收益是否为正</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>当前脚本为研究演示而非交易策略，存在严重前视与执行落地难题。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>1) 动态滚动重算股票池或使用公开风格指数；2) 将价格求和改为收益率加权/市值加权；3) 采用 Walk-forward 训练-验证减少过拟合。</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>脚本未提供下单逻辑、手续费、滑点模型，默认按 A 股常规佣金 0.3‰+过户费计, 预测信号按收盘后运行，次日集合竞价全额建/平仓</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>8</td></tr>
                <tr><td>滑点</td><td>8</td></tr>
                <tr><td>成本</td><td>7</td></tr>
                <tr><td>执行难度</td><td>7</td></tr>
                <tr><td>时间敏感性</td><td>5</td></tr>
                <tr><td>综合可执行性</td><td>3.8</td></tr>
                <tr><td>大资金不友好</td><td>8</td></tr>
                <tr><td>行为偏差利用</td><td>4</td></tr>
                <tr><td>跨阶段稳健性</td><td>4</td></tr>
                <tr><td>有效性总分</td><td>5.5</td></tr>
                <tr><td>总分</td><td>47.2</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;MicroCap-LargeCap CUSUM-ML 5日择时&quot;,
    &quot;strategy_type&quot;: &quot;小市值轮动 + 统计套利/趋势判断&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;先把同一指数成份股按当下流通市值从小到大切成『微盘股组』（最小200 只）与『大盘股组』（最大200 只），将各组日行情简单求和构造两条“伪指数”。对两条序列做：(1) CUSUM 检测拐点，记录过去买卖次数；(2) 计算 5 日窗口涨跌幅统计并把大小盘的统计量拼接成特征；(3) 用 XGBoost 回归拟合“微盘股指数”的点位，并外推未来 5 个交易日。根据回测段微盘指数 + 预测段 5 日序列再次跑 CUSUM，若出现上拐点给出买入信号，出现下拐点给出卖出信号。赚钱来源假设为：在大小盘风格切换时，及时切入（或撤离）高 β 的微盘股组以博取超额收益，并利用大小盘回归关系进行对冲。&quot;,
        &quot;data_and_indicators&quot;: &quot;1) 日线 open/close/high/low/volume/money（聚宽 get_price）\n2) valuation.circulating_market_cap、indicator.eps（聚宽财务因子，日频调用，实际财报披露为季频）\n3) 交易日历( get_trade_days )\n4) 技术指标: SMA、STDDEV (talib)\n5) 统计量: 5 日窗口均值/极值/方差/标准差&quot;,
        &quot;stock_pool&quot;: &quot;以 000985.XSHG 指数成份为基础，排除代码前缀 3/68/4/8，过滤 ST、停牌、新上市≤365 天及退市个股；再按『当前时点』流通市值升序切分头尾各 200 只做大小盘组合；并要求 eps&gt;0。&quot;,
        &quot;buy_signals&quot;: [&quot;CUSUM 算法检测到微盘指数向上突破（S_h 超阈值）&quot;, &quot;未来 5 日 ML 预测序列亦出现上拐点&quot;],
        &quot;sell_signals&quot;: [&quot;CUSUM 检测到微盘指数向下突破（S_l 超阈值）&quot;, &quot;未来 5 日 ML 预测序列出现下拐点&quot;],
        &quot;position_and_risk&quot;: &quot;代码中未给出任何持仓/权重/止损控制。\n缺失信息/你的假设：若实盘执行需等权买入 200 只微盘股并用对冲比例 slope 卖空大盘 ETF 或指数期货降低 β。&quot;,
        &quot;trading_frequency&quot;: &quot;CUSUM+预测信号一旦触发即调仓，理论上≈日级检查，实际频率取决于拐点出现次数。&quot;,
        &quot;manual_execution_guide&quot;: &quot;仅提供研究脚本，未嵌入 initialize/handle_data。若人工执行，可在收盘后跑脚本-&gt;第二个交易日上午集合竞价完成买卖。&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;否（未直接调用已知未来价格），但存在成份/因子顺序前视问题&quot;,
        &quot;risk_level&quot;: &quot;高&quot;,
        &quot;risk_score&quot;: 8,
        &quot;risk_score_reason&quot;: &quot;stock_pool 构造使用 get_stock(&#x27;AA&#x27;, current_time) 以及 get_fundamentals(..., end_date=current_time) —— 以今天流通市值与 EPS 静态划分 2023-01-01 至今的股票池，属于典型『成份股前视』；CUSUM/特征滑窗亦在训练阶段使用全样本均值方差，无时间切分。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;未发现直接引用未来价格；预测段仅用未来日期做特征。&quot;,
            &quot;financial_data_leak&quot;: &quot;调用 2024-today 的流通市值/盈利数据，覆盖 2023 期间 =&gt; 泄漏。&quot;,
            &quot;index_component_leak&quot;: &quot;以 today 的大小盘排序回溯 2023 整段，严重前视。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;脚本不走回测引擎，无引擎层面泄漏。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;在回测循环内按 T-1 财务数据和当日市值动态重算股票池；或直接用 Wind style 指数、大小盘 ETF 代替自建指数，避免成份前视。&quot;,
        &quot;gray_area_warnings&quot;: [&quot;CUSUM 阈值 0.1×std 极低，信号易噪声过度交易&quot;, &quot;指数用简单求和未做市值或数量归一化，尺度漂移大&quot;, &quot;XGBoost 训练未做时间序列验证，容易过拟合&quot;]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 8,
        &quot;slippage_reason&quot;: &quot;一次性等权 200 只微盘股，很多日成交额 &lt;2000 万，冲击成本高，滑点显著。&quot;,
        &quot;cost_score&quot;: 7,
        &quot;cost_reason&quot;: &quot;信号触发依赖 CUSUM，近似日级，满仓换手需付印花税+佣金+冲击费。&quot;,
        &quot;execution_score&quot;: 7,
        &quot;execution_reason&quot;: &quot;买 200 只小票并对冲大盘 ETF/IF 合约，需拆单、抢开盘流动性，若资金上亿几乎无法完成。&quot;,
        &quot;time_sensitivity_score&quot;: 5,
        &quot;time_sensitivity_reason&quot;: &quot;信号基于日线收盘，可次日开盘执行；中等敏感。&quot;,
        &quot;overall_executability&quot;: 4,
        &quot;overall_reason&quot;: &quot;仅适合 ≤500 万规模试验，需工程化批量交易与 TCA。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;流动性充裕，可手动/市价完成。&quot;,
            &quot;100w&quot;: &quot;需分批 + 低冲击原则，仍可执行。&quot;,
            &quot;1000w&quot;: &quot;微盘股组合成交量不足，被动吃掉 5%+ 深度，滑点失控。&quot;,
            &quot;1y&quot;: &quot;不可行，需改用 ETF 或指数期货实现风格轮动。&quot;
        },
        &quot;improvement_suggestions&quot;: [&quot;改用中证 1000、沪深 300 ETF 做多空，回避个股流动性&quot;, &quot;将 CUSUM 信号阈值根据 ATR/波动自适应，减少过度换手&quot;]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 8,
        &quot;large_fund_unfriendly_reason&quot;: &quot;微盘股容量极低且持仓分散 200 只，资金越大越难进出。&quot;,
        &quot;behavioral_bias_score&quot;: 4,
        &quot;behavioral_bias_reason&quot;: &quot;策略主要依赖大小盘风格切换，未明显利用情绪/行为偏差。&quot;,
        &quot;cross_period_robustness_score&quot;: 4,
        &quot;cross_period_robustness_reason&quot;: &quot;参数、股票池前视严重，缺少滚动验证，跨周期稳健性存疑。&quot;,
        &quot;effectiveness_total_score&quot;: 4.5,
        &quot;weight_explanation&quot;: &quot;大资金不友好40%+行为利用30%+跨阶段稳健30%&quot;,
        &quot;worst_environments&quot;: [&quot;微盘股整体流动性枯竭/连板跌停&quot;, &quot;大小盘同跌的系统性风险&quot;],
        &quot;verifiable_predictions&quot;: [&quot;未来 5 个交易日微盘指数涨跌方向由脚本给出&quot;, &quot;大小盘涨跌幅回归系数 slope≈1 是否长期稳定&quot;, &quot;CUSUM 信号触发后 10 日期望收益是否为正&quot;]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;当前脚本为研究演示而非交易策略，存在严重前视与执行落地难题。&quot;,
        &quot;recommendation&quot;: &quot;直接放弃原版，若看好思路，可重构为 ETF 多空且剔除前视再小仓验证。&quot;,
        &quot;optimization_suggestions&quot;: &quot;1) 动态滚动重算股票池或使用公开风格指数；2) 将价格求和改为收益率加权/市值加权；3) 采用 Walk-forward 训练-验证减少过拟合。&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 8,
        &quot;slippage&quot;: 8,
        &quot;cost&quot;: 7,
        &quot;execution&quot;: 7,
        &quot;time_sensitivity&quot;: 5,
        &quot;executability&quot;: 4,
        &quot;effectiveness_a&quot;: 8,
        &quot;effectiveness_b&quot;: 4,
        &quot;effectiveness_c&quot;: 4,
        &quot;effectiveness_total&quot;: 4.5
    },
    
    &quot;assumptions&quot;: [&quot;脚本未提供下单逻辑、手续费、滑点模型，默认按 A 股常规佣金 0.3‰+过户费计&quot;, &quot;预测信号按收盘后运行，次日集合竞价全额建/平仓&quot;]
}
```</pre>
        </div>

    </div>
</body>
</html>