<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宽基ETF-BBI动量轮动 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>宽基ETF-BBI动量轮动</h1>
        <p class="meta">
            ID: e242bbe4 | 
            类型: 动量策略 | 
            来源: b2324_68.宽基BBI动量追涨，完美避开这波大跌~.txt |
            分析日期: 2026-01-11 18:25:41
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>每天 11:15 计算多只宽基指数 30 分钟级别的 BBI(3,6,12,24) 均线。价格相对 BBI 乖离最强（BBI/Close 值最小）的指数被认定为当前最强动量；将全部资金买入其对应 ETF。若大盘指数集合（上证、深成指、创业板、中证1000）前一交易日全部为非正收益，则清仓，回避下跌。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>可交易资产限定为 g.ETF_list 中 11 支宽基 ETF；通过 make_sure_etf_ipo() 过滤未上市满 5 个交易日的 ETF。未做 ST/停牌/涨跌停/流动性过滤（ETF 层面影响较小）。</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>信号1：大盘情绪过滤 today_increase &gt; 0（至少有 1 个核心指数过去 1 个交易日上涨）, 信号2：在 available_indexs 中选择 BBI/Close 最小和次小的指数；若当前持仓既不是这两个，则清仓后全仓买入最小值对应 ETF</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>信号1：today_increase ≤ 0，判定为集体下跌，全部清仓, 信号2：持仓 ETF 不是 BBI/Close 前两名时，先卖出再买入最新目标</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>单只 ETF 满仓；无杠杆；无止损；无最大回撤/波动控制；风险完全来自指数波动和情绪过滤失效。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>理论上日频，每个交易日 11:15 运行一次 market_buy()。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>盘前：无需操作；11:15 后根据当日计算结果全仓申购/赎回对应 ETF；收盘后记录持仓。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>使用 get_bars(..., unit=&#x27;30m&#x27;, include_now=True) 与 BBI(include_now=True) 在 11:15 调用时可能拿到 11:30 尚未结束 K 线的收盘价，属于未来价格泄漏；daily 1d bar include_now=True 亦存在当日未收盘数据风险。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>使用 BBI/Close 比值与常见动量逻辑差异大，可能过拟合, 全仓单 ETF，若出现熔断/停牌无法及时退出, 情绪过滤 today_increase 基于极短期（1 日）涨跌，噪声大</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>高流动性 ETF + 低换手 -&gt; 实盘执行基本无障碍。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>几笔即可成交，几乎无冲击</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>一次性市价扫单滑点 &lt;0.01%</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>需要分批，但 50ETF/300ETF 等日均成交额 &gt;50 亿，可容纳</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>1 亿资金占日成交额 &lt;0.5%，可执行</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>目标资产为宽基 ETF，容量极大。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>利用动量与情绪（上涨追涨，下跌空仓），中等程度利用市场非理性。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>逻辑简单但参数（30m+BBI+日涨跌过滤）较细，跨牛熊稳定性一般。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>震荡市：指数频繁上/下穿 BBI，导致高换手亏损, V 型急跌：上午强势下午跳水，日内止损缺失</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>在单边上涨行情中，本策略收益率应显著高于等权 ETF 持有, 在 30 分钟级别趋势反复横盘时，策略换手率显著上升且收益回撤扩大, 实盘收益对 11:15-11:30 区间波动敏感</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>逻辑直观、执行简单，但当前版本存在未来价格泄漏风险，且风险管理粗糙。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>1) 调整调仓时间/数据截面避开未来函数；2) 引入多 ETF 分散或仓位控制；3) 结合波动率或更长周期动量过滤提升稳健性</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>资金规模、初始本金、再投资策略等未在代码中给出，默认 1× 基金单位净值全仓；, 交易费用按 set_order_cost(open/close_commission=0.00006) 执行；实盘需计入基金申购赎回费、短期赎回费等差异；, FixedSlippage(0.001) 仅为回测假设，实盘 ETF 滑点更低；, 假定 JoinQuant 在 11:15 调用 get_bars(unit=&#x27;30m&#x27;, include_now=True) 会返回 11:30 尚未结束 bar，这构成未来函数风险；若真实为上一完整 bar，则风险下降。</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>7</td></tr>
                <tr><td>滑点</td><td>2</td></tr>
                <tr><td>成本</td><td>4</td></tr>
                <tr><td>执行难度</td><td>8</td></tr>
                <tr><td>时间敏感性</td><td>4</td></tr>
                <tr><td>综合可执行性</td><td>6.7</td></tr>
                <tr><td>大资金不友好</td><td>2</td></tr>
                <tr><td>行为偏差利用</td><td>5</td></tr>
                <tr><td>跨阶段稳健性</td><td>5</td></tr>
                <tr><td>有效性总分</td><td>3.9</td></tr>
                <tr><td>总分</td><td>51.8</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;宽基ETF-BBI动量轮动&quot;,
    &quot;strategy_type&quot;: &quot;动量策略&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;每天 11:15 计算多只宽基指数 30 分钟级别的 BBI(3,6,12,24) 均线。价格相对 BBI 乖离最强（BBI/Close 值最小）的指数被认定为当前最强动量；将全部资金买入其对应 ETF。若大盘指数集合（上证、深成指、创业板、中证1000）前一交易日全部为非正收益，则清仓，回避下跌。&quot;,
        &quot;data_and_indicators&quot;: &quot;使用 index 级别的 30 分钟 K 线（price.close）计算 BBI；使用 1 日 K 线计算 2 日涨跌幅。只依赖价格数据，无财务/因子。&quot;,
        &quot;stock_pool&quot;: &quot;可交易资产限定为 g.ETF_list 中 11 支宽基 ETF；通过 make_sure_etf_ipo() 过滤未上市满 5 个交易日的 ETF。未做 ST/停牌/涨跌停/流动性过滤（ETF 层面影响较小）。&quot;,
        &quot;buy_signals&quot;: [
            &quot;信号1：大盘情绪过滤 today_increase &gt; 0（至少有 1 个核心指数过去 1 个交易日上涨）&quot;,
            &quot;信号2：在 available_indexs 中选择 BBI/Close 最小和次小的指数；若当前持仓既不是这两个，则清仓后全仓买入最小值对应 ETF&quot;
        ],
        &quot;sell_signals&quot;: [
            &quot;信号1：today_increase ≤ 0，判定为集体下跌，全部清仓&quot;,
            &quot;信号2：持仓 ETF 不是 BBI/Close 前两名时，先卖出再买入最新目标&quot;
        ],
        &quot;position_and_risk&quot;: &quot;单只 ETF 满仓；无杠杆；无止损；无最大回撤/波动控制；风险完全来自指数波动和情绪过滤失效。&quot;,
        &quot;trading_frequency&quot;: &quot;理论上日频，每个交易日 11:15 运行一次 market_buy()。&quot;,
        &quot;manual_execution_guide&quot;: &quot;盘前：无需操作；11:15 后根据当日计算结果全仓申购/赎回对应 ETF；收盘后记录持仓。&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;是&quot;,
        &quot;risk_level&quot;: &quot;高&quot;,
        &quot;risk_score&quot;: 7,
        &quot;risk_score_reason&quot;: &quot;使用 get_bars(..., unit=&#x27;30m&#x27;, include_now=True) 与 BBI(include_now=True) 在 11:15 调用时可能拿到 11:30 尚未结束 K 线的收盘价，属于未来价格泄漏；daily 1d bar include_now=True 亦存在当日未收盘数据风险。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;market_buy 第 29 行 get_bars(index, 1, &#x27;30m&#x27;, include_now=True)；回测时 11:15 可以读取 11:30 完整 bar，实盘不可能。&quot;,
            &quot;financial_data_leak&quot;: &quot;未调用财务数据 =&gt; 无此风险&quot;,
            &quot;index_component_leak&quot;: &quot;只用指数收盘价，无成分/权重未来泄漏&quot;,
            &quot;backtest_engine_leak&quot;: &quot;未发现其他回测引擎层面的隐式未来函数&quot;
        },
        &quot;fix_suggestions&quot;: &quot;1) 将 run_daily 时间调整到 11:30 以后，或 11:00；2) get_bars/BBl 调用改为 include_now=False，确保只用已收盘的 bar。&quot;,
        &quot;gray_area_warnings&quot;: [
            &quot;使用 BBI/Close 比值与常见动量逻辑差异大，可能过拟合&quot;,
            &quot;全仓单 ETF，若出现熔断/停牌无法及时退出&quot;,
            &quot;情绪过滤 today_increase 基于极短期（1 日）涨跌，噪声大&quot;
        ]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 2,
        &quot;slippage_reason&quot;: &quot;宽基 ETF 深度充足，11:15 非高波动时段，0.02%级别可成交。&quot;,
        &quot;cost_score&quot;: 4,
        &quot;cost_reason&quot;: &quot;日频轮动，满仓换手时成本≈0.12%（双边 6bp 佣金+0 印花税，仅基金手续费）；若信号频繁切换则月度成本约 2%-3%。&quot;,
        &quot;execution_score&quot;: 8,
        &quot;execution_reason&quot;: &quot;下单品种单一、流动性极高，市价或限价易成交。&quot;,
        &quot;time_sensitivity_score&quot;: 4,
        &quot;time_sensitivity_reason&quot;: &quot;需在 11:15 附近完成下单才能避免使用未来数据，延迟 30 分钟影响有限。&quot;,
        &quot;overall_executability&quot;: 8,
        &quot;overall_reason&quot;: &quot;高流动性 ETF + 低换手 -&gt; 实盘执行基本无障碍。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;几笔即可成交，几乎无冲击&quot;,
            &quot;100w&quot;: &quot;一次性市价扫单滑点 &lt;0.01%&quot;,
            &quot;1000w&quot;: &quot;需要分批，但 50ETF/300ETF 等日均成交额 &gt;50 亿，可容纳&quot;,
            &quot;1y&quot;: &quot;1 亿资金占日成交额 &lt;0.5%，可执行&quot;
        },
        &quot;improvement_suggestions&quot;: [
            &quot;在 11:30 或收盘后调仓，彻底消除未来函数风险&quot;,
            &quot;加入波动率或回撤阈值，降低单 ETF 满仓时的风险集中度&quot;
        ]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 2,
        &quot;large_fund_unfriendly_reason&quot;: &quot;目标资产为宽基 ETF，容量极大。&quot;,
        &quot;behavioral_bias_score&quot;: 5,
        &quot;behavioral_bias_reason&quot;: &quot;利用动量与情绪（上涨追涨，下跌空仓），中等程度利用市场非理性。&quot;,
        &quot;cross_period_robustness_score&quot;: 5,
        &quot;cross_period_robustness_reason&quot;: &quot;逻辑简单但参数（30m+BBI+日涨跌过滤）较细，跨牛熊稳定性一般。&quot;,
        &quot;effectiveness_total_score&quot;: 5.0,
        &quot;weight_explanation&quot;: &quot;大资金友好20%+行为偏差利用40%+跨阶段稳健40%&quot;,
        &quot;worst_environments&quot;: [
            &quot;震荡市：指数频繁上/下穿 BBI，导致高换手亏损&quot;,
            &quot;V 型急跌：上午强势下午跳水，日内止损缺失&quot;
        ],
        &quot;verifiable_predictions&quot;: [
            &quot;在单边上涨行情中，本策略收益率应显著高于等权 ETF 持有&quot;,
            &quot;在 30 分钟级别趋势反复横盘时，策略换手率显著上升且收益回撤扩大&quot;,
            &quot;实盘收益对 11:15-11:30 区间波动敏感&quot;
        ]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;逻辑直观、执行简单，但当前版本存在未来价格泄漏风险，且风险管理粗糙。&quot;,
        &quot;recommendation&quot;: &quot;小仓实测（修复未来函数后）&quot;,
        &quot;optimization_suggestions&quot;: &quot;1) 调整调仓时间/数据截面避开未来函数；2) 引入多 ETF 分散或仓位控制；3) 结合波动率或更长周期动量过滤提升稳健性&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 7,
        &quot;slippage&quot;: 2,
        &quot;cost&quot;: 4,
        &quot;execution&quot;: 8,
        &quot;time_sensitivity&quot;: 4,
        &quot;executability&quot;: 8,
        &quot;effectiveness_a&quot;: 2,
        &quot;effectiveness_b&quot;: 5,
        &quot;effectiveness_c&quot;: 5,
        &quot;effectiveness_total&quot;: 5.0
    },
    
    &quot;assumptions&quot;: [
        &quot;资金规模、初始本金、再投资策略等未在代码中给出，默认 1× 基金单位净值全仓；&quot;,
        &quot;交易费用按 set_order_cost(open/close_commission=0.00006) 执行；实盘需计入基金申购赎回费、短期赎回费等差异；&quot;,
        &quot;FixedSlippage(0.001) 仅为回测假设，实盘 ETF 滑点更低；&quot;,
        &quot;假定 JoinQuant 在 11:15 调用 get_bars(unit=&#x27;30m&#x27;, include_now=True) 会返回 11:30 尚未结束 bar，这构成未来函数风险；若真实为上一完整 bar，则风险下降。&quot;
    ]
}
```</pre>
        </div>

    </div>
</body>
</html>