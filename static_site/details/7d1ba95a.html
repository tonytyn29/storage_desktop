<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大⇆小市值月度切换 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>大⇆小市值月度切换</h1>
        <p class="meta">
            ID: 7d1ba95a | 
            类型: 市值轮动 + 基本面过滤 | 
            来源: b25_39干积分-大小盘反复横跳V2.0.txt |
            分析日期: 2026-01-10 22:23:47
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>比较近 1 个月（20 个交易日）内中证2000 成分股均值涨跌幅(记作BIG) 与中证500 成分股均值涨跌幅(记作SMALL) 的相对强弱。如果 BIG/SMALL &gt; 1.2，认为大盘股强势，选取符合基本面筛选且市值最大的 5 只大盘股等权持有；否则认为小盘股占优，选取基本面过关且低价（&lt;10 元）、小市值、近期未涨停的 5 只小盘股等权持有。月初 (每月第 1 个交易日 9:30) 调仓；日内 14:00 对前一交易日的涨停股进行动量止盈/止损判断（开板就卖）。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>初始全 A 股（剔除科创板 688*, 北交所 83/87*, 创业板 3****），过滤 ST/停牌/近 375 天内上市新股/当日涨跌停股；小盘模式再剔除股价≥10 元个股；大盘模式不做价格、市值下限过滤，只按 fundamentals+市值降序取前 5。</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>1. 月初 9:30 判断 BIG/SMALL 相对强度，大于 1.2 时进入“大盘”模式，否则“小盘”模式。, 2. 在对应模式下，按基本面与市值排序得到 target_list，持仓不足 5 只时，按等权（现金 / 缺口数量）下单买入。</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>1. 月度调仓时：凡不在新 target_list 且前一日未涨停的持仓，一律清仓。, 2. 若个股前一日涨停，次日 14:00 若涨停板被打开则立即清仓。</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>最多持仓 5 只股票，单票等权。未设置总仓上限，默认满仓（现金全部买满 5 只）。无集中度或回撤控制；浮亏/盈利止损函数存在但被注释掉（sell_stocks 未运行）。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>每月一次主调仓（run_monthly 的 first trading day 9:30）；其余仅在个别涨停股开板时 14:00 可能触发卖出。每日 9:05 仅做数据准备，无交易。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>1) 盘前：无需操作；2) 9:25—9:30 预先生成大/小盘判断及 target_list；3) 开盘后 9:30 按等权买入/卖出；4) 14:00 观察昨日涨停股是否开板，若开板立即市价卖出；5) 14:30 再次检查若设有 g.no_trading_today_signal 时清仓（目前代码从未置 True）。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>在 monthly 调仓中使用 get_index_stocks(index, now_time) 获取今日(9:30) 的指数成份股，再用这些成份去回看过去 20 天收益 (get_price end_date=yesterday)，造成“成份股未来漏看”风险；此外未发现明显的 price history 泄漏。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>指数成份股未来漏看可能在回测中高估收益。, 未考虑财报实际披露日的可得性，可能轻微前视。, 固定成交价格=0 滑点，与实盘差异大，回测容易高估收益。</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>小资金(&lt;500 万)可行；需注意开盘大单对低价小盘股冲击。大资金执行难度升高。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>基本可完全跟单，冲击可忽略。</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>仍可执行，但需分批下单避免拉高小盘股价格。</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>小盘模式流动性不足，需扩大股票数量或采用限价单，整体可执行性下降。</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>对 1 亿资金，仅适合大盘模式；小盘模式几乎无法一次性买足，需重大改造。</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>小盘模式挑选低价小市值前五名，容量有限，容易推高股价。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>利用近期涨停回避、低价+高质量小票的潜在市场误定价，以及大小盘风格切换动量；行为成分中等。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>核心逻辑依赖于风格轮动是否持续存在；简洁但参数（阈值1.2、20日）较拍脑袋，难免过拟合。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>大小盘风格分化不明显、频繁轮动导致高换手, 流动性危机导致小盘股流动性骤降且难以卖出，涨停打开后快速跌停</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>当过去 20 交易日中证2000 平均涨幅显著跑赢中证500 时，未来一个月大盘股跑输，反之小盘股跑赢。, 满足高 ROE/ROA、低价小市值组合在小盘风格主导环境下将获得超额收益。, 前一日涨停且当日冲高未封板的个股在 14:00 后易出现回落，提前卖出可避免部分回撤。</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>思路简单有趣，未来函数风险中等，小盘模式实盘容量受限；需修复指数成份前视并加入真实交易约束。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>1) 修正指数成份前视，改用历史 constituents；2) 将 g.stock_num 提高到 10-15，放宽价格限制提升容量；3) 纳入动态止损/风控，控制回撤；4) 引入滑点与分批限价下单，贴近实盘。</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>默认资金规模未给出，评估时以 100 万为基准；滑点模型设为 0 但实盘肯定存在，本文按一般小盘股早盘 2-10bp 假定评分。, 回测引擎启用 avoid_future_data，可保证财报发布时间不前视；本报告仍提示可能存在边界效应未充分验证。</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>6</td></tr>
                <tr><td>滑点</td><td>5</td></tr>
                <tr><td>成本</td><td>3</td></tr>
                <tr><td>执行难度</td><td>6</td></tr>
                <tr><td>时间敏感性</td><td>4</td></tr>
                <tr><td>综合可执行性</td><td>6.3</td></tr>
                <tr><td>大资金不友好</td><td>7</td></tr>
                <tr><td>行为偏差利用</td><td>5</td></tr>
                <tr><td>跨阶段稳健性</td><td>5</td></tr>
                <tr><td>有效性总分</td><td>5.7</td></tr>
                <tr><td>总分</td><td>59.8</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>{
    &quot;strategy_name&quot;: &quot;大⇆小市值月度切换&quot;,
    &quot;strategy_type&quot;: &quot;市值轮动 + 基本面过滤&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;比较近 1 个月（20 个交易日）内中证2000 成分股均值涨跌幅(记作BIG) 与中证500 成分股均值涨跌幅(记作SMALL) 的相对强弱。如果 BIG/SMALL &gt; 1.2，认为大盘股强势，选取符合基本面筛选且市值最大的 5 只大盘股等权持有；否则认为小盘股占优，选取基本面过关且低价（&lt;10 元）、小市值、近期未涨停的 5 只小盘股等权持有。月初 (每月第 1 个交易日 9:30) 调仓；日内 14:00 对前一交易日的涨停股进行动量止盈/止损判断（开板就卖）。&quot;,
        &quot;data_and_indicators&quot;: &quot;1) 价格数据: 分钟级 close, daily close、high_limit/low_limit 用于涨跌停过滤及涨幅计算；2) 财务数据: ROE, ROA, PE(LYR), PS, PCF, EPS, 净利率、毛利率、营收同比(均为最近已披露季报)，查询频率为月度调仓当日 9:30; 3) 指数成分股列表: get_index_stocks 每月获取一次；4) 股票基本信息(上市日期)、停牌/ST 状态。&quot;,
        &quot;stock_pool&quot;: &quot;初始全 A 股（剔除科创板 688*, 北交所 83/87*, 创业板 3****），过滤 ST/停牌/近 375 天内上市新股/当日涨跌停股；小盘模式再剔除股价≥10 元个股；大盘模式不做价格、市值下限过滤，只按 fundamentals+市值降序取前 5。&quot;,
        &quot;buy_signals&quot;: [
            &quot;1. 月初 9:30 判断 BIG/SMALL 相对强度，大于 1.2 时进入“大盘”模式，否则“小盘”模式。&quot;,
            &quot;2. 在对应模式下，按基本面与市值排序得到 target_list，持仓不足 5 只时，按等权（现金 / 缺口数量）下单买入。&quot;
        ],
        &quot;sell_signals&quot;: [
            &quot;1. 月度调仓时：凡不在新 target_list 且前一日未涨停的持仓，一律清仓。&quot;,
            &quot;2. 若个股前一日涨停，次日 14:00 若涨停板被打开则立即清仓。&quot;
        ],
        &quot;position_and_risk&quot;: &quot;最多持仓 5 只股票，单票等权。未设置总仓上限，默认满仓（现金全部买满 5 只）。无集中度或回撤控制；浮亏/盈利止损函数存在但被注释掉（sell_stocks 未运行）。&quot;,
        &quot;trading_frequency&quot;: &quot;每月一次主调仓（run_monthly 的 first trading day 9:30）；其余仅在个别涨停股开板时 14:00 可能触发卖出。每日 9:05 仅做数据准备，无交易。&quot;,
        &quot;manual_execution_guide&quot;: &quot;1) 盘前：无需操作；2) 9:25—9:30 预先生成大/小盘判断及 target_list；3) 开盘后 9:30 按等权买入/卖出；4) 14:00 观察昨日涨停股是否开板，若开板立即市价卖出；5) 14:30 再次检查若设有 g.no_trading_today_signal 时清仓（目前代码从未置 True）。&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;是&quot;,
        &quot;risk_level&quot;: &quot;中&quot;,
        &quot;risk_score&quot;: 6,
        &quot;risk_score_reason&quot;: &quot;在 monthly 调仓中使用 get_index_stocks(index, now_time) 获取今日(9:30) 的指数成份股，再用这些成份去回看过去 20 天收益 (get_price end_date=yesterday)，造成“成份股未来漏看”风险；此外未发现明显的 price history 泄漏。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;使用 history(1,&#x27;1m&#x27;) 于 9:05/9:30 查询当日尚未开盘的 1 分钟价格，若 JoinQuant 返回前一交易日 14:59 收盘价则无问题；若返回今日 9:30 价则有前视风险，需确认回测引擎行为。&quot;,
            &quot;financial_data_leak&quot;: &quot;get_fundamentals(date=None) 在 9:30 调用，JQ 避未来开关启用，理论上只返回已披露数据，问题较小。&quot;,
            &quot;index_component_leak&quot;: &quot;使用“now_time”而非“yesterday”获取指数成份，导致回看 20 日收益时包含未来成份信息，属于常见的前视偏差。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;其他调用（get_price, history）均设置 end_date&lt;=previous_date，符合规范。无严重引擎级漏洞。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;在获取指数成份股时应使用昨收日期 (context.previous_date) 或更早日期，避免用今日日期；或直接用历史组件表。确认 history(1,&#x27;1m&#x27;) 在 9:05/9:30 取值是否为昨日收盘，若不确定改用 get_price(count=1, end_date=context.previous_date,...).&quot;,
        &quot;gray_area_warnings&quot;: [
            &quot;指数成份股未来漏看可能在回测中高估收益。&quot;,
            &quot;未考虑财报实际披露日的可得性，可能轻微前视。&quot;,
            &quot;固定成交价格=0 滑点，与实盘差异大，回测容易高估收益。&quot;
        ]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 5,
        &quot;slippage_reason&quot;: &quot;等权买入 5 只、早盘开盘竞价或 9:30 立即市价下单；小盘模式限制股价&lt;10且小市值，若容量大则冲击明显。&quot;,
        &quot;cost_score&quot;: 3,
        &quot;cost_reason&quot;: &quot;月度调仓 + 偶发止损，换手中低；费率参数合理（双边 0.0006+千分之一印花）。&quot;,
        &quot;execution_score&quot;: 6,
        &quot;execution_reason&quot;: &quot;持股多为低价小盘股，流动性可能不足；大盘模式无碍，小盘模式成交可能需拆单。&quot;,
        &quot;time_sensitivity_score&quot;: 4,
        &quot;time_sensitivity_reason&quot;: &quot;主要在 9:30 均价买入，14:00 可能卖出开板股；日内灵敏度中等。&quot;,
        &quot;overall_executability&quot;: 6,
        &quot;overall_reason&quot;: &quot;小资金(&lt;500 万)可行；需注意开盘大单对低价小盘股冲击。大资金执行难度升高。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;基本可完全跟单，冲击可忽略。&quot;,
            &quot;100w&quot;: &quot;仍可执行，但需分批下单避免拉高小盘股价格。&quot;,
            &quot;1000w&quot;: &quot;小盘模式流动性不足，需扩大股票数量或采用限价单，整体可执行性下降。&quot;,
            &quot;1y&quot;: &quot;对 1 亿资金，仅适合大盘模式；小盘模式几乎无法一次性买足，需重大改造。&quot;
        },
        &quot;improvement_suggestions&quot;: [
            &quot;提高股票数量或放宽价格/市值限制，降低冲击。&quot;,
            &quot;引入限价和分批下单逻辑，模拟真实交易滑点。&quot;
        ]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 7,
        &quot;large_fund_unfriendly_reason&quot;: &quot;小盘模式挑选低价小市值前五名，容量有限，容易推高股价。&quot;,
        &quot;behavioral_bias_score&quot;: 5,
        &quot;behavioral_bias_reason&quot;: &quot;利用近期涨停回避、低价+高质量小票的潜在市场误定价，以及大小盘风格切换动量；行为成分中等。&quot;,
        &quot;cross_period_robustness_score&quot;: 5,
        &quot;cross_period_robustness_reason&quot;: &quot;核心逻辑依赖于风格轮动是否持续存在；简洁但参数（阈值1.2、20日）较拍脑袋，难免过拟合。&quot;,
        &quot;effectiveness_total_score&quot;: 5.6,
        &quot;weight_explanation&quot;: &quot;大资金不友好40% (0.4*7) + 行为偏差30% (0.3*5) + 稳健性30% (0.3*5) = 5.6&quot;,
        &quot;worst_environments&quot;: [
            &quot;大小盘风格分化不明显、频繁轮动导致高换手&quot;,
            &quot;流动性危机导致小盘股流动性骤降且难以卖出，涨停打开后快速跌停&quot;
        ],
        &quot;verifiable_predictions&quot;: [
            &quot;当过去 20 交易日中证2000 平均涨幅显著跑赢中证500 时，未来一个月大盘股跑输，反之小盘股跑赢。&quot;,
            &quot;满足高 ROE/ROA、低价小市值组合在小盘风格主导环境下将获得超额收益。&quot;,
            &quot;前一日涨停且当日冲高未封板的个股在 14:00 后易出现回落，提前卖出可避免部分回撤。&quot;
        ]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;思路简单有趣，未来函数风险中等，小盘模式实盘容量受限；需修复指数成份前视并加入真实交易约束。&quot;,
        &quot;recommendation&quot;: &quot;小仓实测&quot;,
        &quot;optimization_suggestions&quot;: &quot;1) 修正指数成份前视，改用历史 constituents；2) 将 g.stock_num 提高到 10-15，放宽价格限制提升容量；3) 纳入动态止损/风控，控制回撤；4) 引入滑点与分批限价下单，贴近实盘。&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 6,
        &quot;slippage&quot;: 5,
        &quot;cost&quot;: 3,
        &quot;execution&quot;: 6,
        &quot;time_sensitivity&quot;: 4,
        &quot;executability&quot;: 6,
        &quot;effectiveness_a&quot;: 7,
        &quot;effectiveness_b&quot;: 5,
        &quot;effectiveness_c&quot;: 5,
        &quot;effectiveness_total&quot;: 5.6
    },
    
    &quot;assumptions&quot;: [
        &quot;默认资金规模未给出，评估时以 100 万为基准；滑点模型设为 0 但实盘肯定存在，本文按一般小盘股早盘 2-10bp 假定评分。&quot;,
        &quot;回测引擎启用 avoid_future_data，可保证财报发布时间不前视；本报告仍提示可能存在边界效应未充分验证。&quot;
    ]
}</pre>
        </div>

    </div>
</body>
</html>