<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小市值早盘剥头皮T+1 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>小市值早盘剥头皮T+1</h1>
        <p class="meta">
            ID: 2cd58e72 | 
            类型: 小市值轮动 / 盘中短线动量 | 
            来源: b2324_20.有赚就好-小市值剥头皮改进 2年3.86%回撤.txt |
            分析日期: 2026-01-11 15:04:48
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>每天在开盘后迅速买入上一交易日走势略强、最近4日波动＜10%的超小市值股票，并在第二天 10:30 全部卖出，赚取隔夜到早盘第一小时之间的价格跳升或流动性溢价。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>1) A 股全部普通股 → 2) 剔除停牌、ST、*、退市预警 → 3) 剔除科创板、北交所、创业板、B 股 → 4) 取市值最小的 500 只 → 5) 剔除开盘即涨/跌停的股票 → 6) 剔除 5 个自然日内有停牌的股票 → 7) 最近 4 日振幅＜10% → 8) 前一日收盘高于 5 日 EMA 且今日开盘低于昨日最低价。</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>满足全部过滤条件后，在 09:30 按等额资金买入（最多 7 只）。, 单票投入 = 当日可用现金 / 新开仓槽位数，整股下单。</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>每天 10:30 对所有持仓执行 order_target(s,0) 清仓。, 无止损/止盈，纯时间止盈。</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>最多 7 只，满仓（现金全部分配）。无单票/组合风控；无追保；无仓位上限控制。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>几乎每天都可能买卖；买入调用 buy() 于 09:30，卖出调用 sell() 于 10:30。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>盘前：按市值筛选 500 只候选+预过滤；09:30 市价或限价买入；第二个交易日 10:30 清仓。需 T+1 规则，不可当日反向平仓。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>before_trading_start 中使用 current_data[s].day_open 取当日开盘价（市场尚未开盘），属于典型的未来数据泄漏；同时 filter_limitup_stock 在盘前调用 1 分钟线最新价 history(1,&#x27;1m&#x27;)，在某些回测引擎版本中也可能拿到当日 09:30 的数据。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>持仓未考虑 T+1，若取消 t0_mode 可能导致回测能卖而实盘卖不掉。, 小市值股票成交量低，回测滑点低估。, 盘中下单时点固定，实盘遇临时停牌或集合竞价延迟会无法成交。</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>小资金可做；≥1000 万元需考虑冲击成本；大资金几乎无法执行。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>可基本复现回测；单笔 1.4 万左右满足最小手续费门槛。</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>部分标的挂单量不足；需分批成交；滑点明显扩大。</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>买入 7 只平均 140 万/只，对 20 亿以下市值个股冲击显著；成交极难。</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>基本不可行，流动性与监管双重限制。</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>超小市值+早盘集中成交，对资金容量极度敏感。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>利用隔夜信息不充分定价+开盘情绪波动，部分基于行为偏差。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>策略依赖低市值盛行、涨跌停机制稳定的市场，牛市/熊市分化大。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>高波动单边下跌（超跌反弹乏力）, 监管严打小市值投机、流动性枯竭</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>买入组隔夜收益大于基准且夏普较高, 收益主要来自开盘-10:30 区间，午后无显著 alpha, 策略收益与市场情绪（情绪指数、北向资金）呈正相关</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>存在未来函数嫌疑且交易成本/滑点被严重低估，回测结果可信度有限。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>1) 去除盘前使用当日开盘价；2) 引入换手率/成交额过滤；3) 设置止损止盈或动态回避涨跌停；4) 评估滑点并使用成交额限制。</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>假设1：回测使用默认初始资金 100 万，未在代码中指定。, 假设2：未开启 set_option(&#x27;t0_mode&#x27;,True)，因此同日卖出新买仓位在回测中被系统自动拒绝或顺延至可卖日。</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>8</td></tr>
                <tr><td>滑点</td><td>6</td></tr>
                <tr><td>成本</td><td>7</td></tr>
                <tr><td>执行难度</td><td>5</td></tr>
                <tr><td>时间敏感性</td><td>7</td></tr>
                <tr><td>综合可执行性</td><td>4.9</td></tr>
                <tr><td>大资金不友好</td><td>8</td></tr>
                <tr><td>行为偏差利用</td><td>6</td></tr>
                <tr><td>跨阶段稳健性</td><td>4</td></tr>
                <tr><td>有效性总分</td><td>5.8</td></tr>
                <tr><td>总分</td><td>54.2</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;小市值早盘剥头皮T+1&quot;,
    &quot;strategy_type&quot;: &quot;小市值轮动 / 盘中短线动量&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;每天在开盘后迅速买入上一交易日走势略强、最近4日波动＜10%的超小市值股票，并在第二天 10:30 全部卖出，赚取隔夜到早盘第一小时之间的价格跳升或流动性溢价。&quot;,
        &quot;data_and_indicators&quot;: &quot;• 财务端：valuation.market_cap（每天更新，盘前调用）\n• 价格端：日线(60日收盘、4日最高/最低、前一日收盘/最低)、分钟线(1m 收盘用来判断是否涨跌停)、current_data(日内实时报价: day_open、high_limit、low_limit)\n• 技术指标：TA-Lib 5 日 EMA&quot;,
        &quot;stock_pool&quot;: &quot;1) A 股全部普通股 → 2) 剔除停牌、ST、*、退市预警 → 3) 剔除科创板、北交所、创业板、B 股 → 4) 取市值最小的 500 只 → 5) 剔除开盘即涨/跌停的股票 → 6) 剔除 5 个自然日内有停牌的股票 → 7) 最近 4 日振幅＜10% → 8) 前一日收盘高于 5 日 EMA 且今日开盘低于昨日最低价。&quot;,
        &quot;buy_signals&quot;: [
            &quot;满足全部过滤条件后，在 09:30 按等额资金买入（最多 7 只）。&quot;,
            &quot;单票投入 = 当日可用现金 / 新开仓槽位数，整股下单。&quot;
        ],
        &quot;sell_signals&quot;: [
            &quot;每天 10:30 对所有持仓执行 order_target(s,0) 清仓。&quot;,
            &quot;无止损/止盈，纯时间止盈。&quot;
        ],
        &quot;position_and_risk&quot;: &quot;最多 7 只，满仓（现金全部分配）。无单票/组合风控；无追保；无仓位上限控制。&quot;,
        &quot;trading_frequency&quot;: &quot;几乎每天都可能买卖；买入调用 buy() 于 09:30，卖出调用 sell() 于 10:30。&quot;,
        &quot;manual_execution_guide&quot;: &quot;盘前：按市值筛选 500 只候选+预过滤；09:30 市价或限价买入；第二个交易日 10:30 清仓。需 T+1 规则，不可当日反向平仓。&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;是&quot;,
        &quot;risk_level&quot;: &quot;高&quot;,
        &quot;risk_score&quot;: 8,
        &quot;risk_score_reason&quot;: &quot;before_trading_start 中使用 current_data[s].day_open 取当日开盘价（市场尚未开盘），属于典型的未来数据泄漏；同时 filter_limitup_stock 在盘前调用 1 分钟线最新价 history(1,&#x27;1m&#x27;)，在某些回测引擎版本中也可能拿到当日 09:30 的数据。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;• 行 37: current_data[s].day_open 被盘前调用。\n• 行 72: history(1,&#x27;1m&#x27;) 在盘前理论上拿不到，但部分版本会返回 09:29:59 价格。&quot;,
            &quot;financial_data_leak&quot;: &quot;valuation.market_cap 为静态上一日收盘后披露，暂无泄漏。&quot;,
            &quot;index_component_leak&quot;: &quot;无指数成分依赖，风险低。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;未显式使用 is_st 等未来函数外的避险措施；但 avoid_future_data=True 略微降低风险。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;在 before_trading_start 中移除对 day_open、分钟线的引用；改为在 09:31 以后再判断涨跌停；或使用 pre_open_price 等前一日数据。&quot;,
        &quot;gray_area_warnings&quot;: [
            &quot;持仓未考虑 T+1，若取消 t0_mode 可能导致回测能卖而实盘卖不掉。&quot;,
            &quot;小市值股票成交量低，回测滑点低估。&quot;,
            &quot;盘中下单时点固定，实盘遇临时停牌或集合竞价延迟会无法成交。&quot;
        ]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 6,
        &quot;slippage_reason&quot;: &quot;09:30 开盘即下单+超小市值股票，真实滑点通常＞0.5%，固定 0.02 元低估。&quot;,
        &quot;cost_score&quot;: 7,
        &quot;cost_reason&quot;: &quot;理论上每天双边交易≈14 笔，高换手；卖出端费率 0.13%，加上最小 5 元门槛小资金成本极高。&quot;,
        &quot;execution_score&quot;: 5,
        &quot;execution_reason&quot;: &quot;容量小但下单笔数有限；需拆单或排队，部分股票 1 万手成交量都不到。&quot;,
        &quot;time_sensitivity_score&quot;: 7,
        &quot;time_sensitivity_reason&quot;: &quot;必须 09:30-09:31 内完成买入，10:30 精准卖出，否则收益-风险比骤降。&quot;,
        &quot;overall_executability&quot;: 5,
        &quot;overall_reason&quot;: &quot;小资金可做；≥1000 万元需考虑冲击成本；大资金几乎无法执行。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;可基本复现回测；单笔 1.4 万左右满足最小手续费门槛。&quot;,
            &quot;100w&quot;: &quot;部分标的挂单量不足；需分批成交；滑点明显扩大。&quot;,
            &quot;1000w&quot;: &quot;买入 7 只平均 140 万/只，对 20 亿以下市值个股冲击显著；成交极难。&quot;,
            &quot;1y&quot;: &quot;基本不可行，流动性与监管双重限制。&quot;
        },
        &quot;improvement_suggestions&quot;: [
            &quot;改用分批市价扫单或盘口算法减少冲击。&quot;,
            &quot;增加流动性过滤（换手率、成交额），并动态控制仓位占成交额比例。&quot;
        ]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 8,
        &quot;large_fund_unfriendly_reason&quot;: &quot;超小市值+早盘集中成交，对资金容量极度敏感。&quot;,
        &quot;behavioral_bias_score&quot;: 6,
        &quot;behavioral_bias_reason&quot;: &quot;利用隔夜信息不充分定价+开盘情绪波动，部分基于行为偏差。&quot;,
        &quot;cross_period_robustness_score&quot;: 4,
        &quot;cross_period_robustness_reason&quot;: &quot;策略依赖低市值盛行、涨跌停机制稳定的市场，牛市/熊市分化大。&quot;,
        &quot;effectiveness_total_score&quot;: 5.1,
        &quot;weight_explanation&quot;: &quot;大资金不友好40%+行为利用30%+跨阶段稳健30%&quot;,
        &quot;worst_environments&quot;: [
            &quot;高波动单边下跌（超跌反弹乏力）&quot;,
            &quot;监管严打小市值投机、流动性枯竭&quot;
        ],
        &quot;verifiable_predictions&quot;: [
            &quot;买入组隔夜收益大于基准且夏普较高&quot;,
            &quot;收益主要来自开盘-10:30 区间，午后无显著 alpha&quot;,
            &quot;策略收益与市场情绪（情绪指数、北向资金）呈正相关&quot;
        ]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;存在未来函数嫌疑且交易成本/滑点被严重低估，回测结果可信度有限。&quot;,
        &quot;recommendation&quot;: &quot;小仓实测（先修复未来函数）&quot;,
        &quot;optimization_suggestions&quot;: &quot;1) 去除盘前使用当日开盘价；2) 引入换手率/成交额过滤；3) 设置止损止盈或动态回避涨跌停；4) 评估滑点并使用成交额限制。&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 8,
        &quot;slippage&quot;: 6,
        &quot;cost&quot;: 7,
        &quot;execution&quot;: 5,
        &quot;time_sensitivity&quot;: 7,
        &quot;executability&quot;: 5,
        &quot;effectiveness_a&quot;: 8,
        &quot;effectiveness_b&quot;: 6,
        &quot;effectiveness_c&quot;: 4,
        &quot;effectiveness_total&quot;: 5.1
    },
    
    &quot;assumptions&quot;: [
        &quot;假设1：回测使用默认初始资金 100 万，未在代码中指定。&quot;,
        &quot;假设2：未开启 set_option(&#x27;t0_mode&#x27;,True)，因此同日卖出新买仓位在回测中被系统自动拒绝或顺延至可卖日。&quot;
    ]
}
```</pre>
        </div>

    </div>
</body>
</html>