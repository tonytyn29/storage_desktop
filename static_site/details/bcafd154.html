<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETF折溢价套利双向轮动 - 策略详情</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .meta { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section p, .section pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #ccc;
        }
        pre {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .back-btn:hover { opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.2); color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">← 返回列表</a>
        <h1>ETF折溢价套利双向轮动</h1>
        <p class="meta">
            ID: bcafd154 | 
            类型: 套利策略/均值回归 | 
            来源: b25_62基金溢价（模拟效果好！）.txt |
            分析日期: 2026-01-10 22:41:35
        </p>

        <div class="section">
            <h2>策略逻辑概要</h2>
            <p>利用场内ETF开盘价与前一交易日基金单位净值（NAV）之间的价差。当开盘价低于NAV达到一定幅度（默认≥2.5%）时认为存在负溢价，买入并持有等待价格回归；当已持有ETF的负溢价消失（不再位于最优折价组合）时卖出。通过反复捕捉日内/隔夜的溢价修复来获取超额收益。</p>
        </div>

        <div class="section">
            <h2>股票池</h2>
            <p>全部场内ETF（get_all_securities([&#x27;etf&#x27;])），过滤条件：
1) 前一交易日成交额&gt;1亿元
2) 昨日有除权除息(factor==1  保留)
3) 当日开盘价/NAV溢价绝对值&lt;20%</p>
        </div>

        <div class="section">
            <h2>买入信号</h2>
            <p>premium &lt; -g.least_premium（初始2.5%，若连续无法买到则逐日递减至下限1.5%）, 在折价排序中位列前 g.ETFNum_hold(默认2只)</p>
        </div>

        <div class="section">
            <h2>卖出信号</h2>
            <p>持仓ETF不再位列当日折价前g.ETFNum_hold, 主动划定的负溢价阈值范围之外（即折价不足）</p>
        </div>

        <div class="section">
            <h2>仓位管理</h2>
            <p>最多同时持有 g.ETFNum_hold(=2) 只ETF；资金按照可用现金等权分配；买入按百股整数；无止损/止盈；无行业/指数集中度或系统性风险控制；未使用大盘风控函数（虽然代码备注有）。</p>
        </div>

        <div class="section">
            <h2>交易频率</h2>
            <p>每日一次：09:15获取数据，09:30先卖后买。调仓节奏为日频。</p>
        </div>

        <div class="section">
            <h2>手动执行指南</h2>
            <p>盘前：检查昨日公布的各ETF净值；
09:20~09:28：准备符合折价条件列表；
09:30 开盘后观察开盘价与NAV差异，若折价达到阈值则以市价/溢价2%限价下单；
盘后：记录成交与持仓，更新下一交易日折价阈值。</p>
        </div>

        <div class="section">
            <h2>代码审计详情</h2>
            <p>未使用明显未来函数。所有指标仅用到 T 日开盘价与 T−1 日 NAV。使用 current.day_open 于 09:30 发单，在回测中与实盘时序一致（开盘价在 9:30 即已产生），基本不存在前瞻泄漏。少量风险来自对 day_open 的获取时点与回测撮合模型可能的先验差异。</p>
        </div>

        <div class="section">
            <h2>灰色区域警告</h2>
            <p>开盘价→限价±2% 下单在回测中几乎肯定成交，实盘可能因涨跌停或流动性导致挂单失败。, 爬虫获取实时 NAV 在聚宽实盘受限（服务器无法外网），需自行部署数据或改用官方IOPV接口。, 未处理分级 ETF、跨境或货币型 ETF 的特殊规则，可能出现净值无法对应。</p>
        </div>

        <div class="section">
            <h2>执行分析</h2>
            <p>对小～中等资金具备可操作性；需解决实时 NAV 数据源与开盘挂单的技术实现。</p>
        </div>

        <div class="section">
            <h2>10万资金场景</h2>
            <p>流动性充裕，几乎无冲击，可轻松成交。</p>
        </div>

        <div class="section">
            <h2>100万资金场景</h2>
            <p>仍属安全区间，单日买入&lt;100万/ETF，影响可忽略。</p>
        </div>

        <div class="section">
            <h2>1000万资金场景</h2>
            <p>需分单多日建仓；部分小规模ETF可能容量不足，溢价快速收敛导致难以成交。</p>
        </div>

        <div class="section">
            <h2>1亿资金场景</h2>
            <p>难以在有限折价档中足量成交，易显著冲击价格并放大折/溢价；不建议。</p>
        </div>

        <div class="section">
            <h2>大资金不友好原因</h2>
            <p>仅挑选两只折价最深ETF，且多数ETF容量有限；资金越大越难满仓建仓。</p>
        </div>

        <div class="section">
            <h2>行为偏差利用原因</h2>
            <p>策略利用市场因信息滞后及情绪导致的ETF折溢价偏离，存在一定行为金融效应。</p>
        </div>

        <div class="section">
            <h2>跨阶段稳健性原因</h2>
            <p>折价机会随流动性、市场情绪、监管政策变化而浮动；简易阈值可能失效，需要动态校准。</p>
        </div>

        <div class="section">
            <h2>最差环境</h2>
            <p>单边持续大幅上涨或下跌导致折价机会稀缺, 流动性骤降或ETF大规模申购赎回停牌期间</p>
        </div>

        <div class="section">
            <h2>可验证预测</h2>
            <p>开盘买入折价&gt;2.5%的ETF后1~5个交易日收益为正, 持仓ETF与NAV价差在T+1大概率收敛至±1%, 折价机会数量在高波动/恐慌行情中明显增多</p>
        </div>

        <div class="section">
            <h2>一句话总结</h2>
            <p>简洁的ETF负溢价套利策略，思路清晰，未来函数风险低，但对实时数据来源与开盘成交实施要求较高。</p>
        </div>

        <div class="section">
            <h2>优化建议</h2>
            <p>1) 引入实时 IOPV 或官方实时估值接口；2) 增加回撤控制与持仓分散；3) 改进仓位/阈值动态调整逻辑；4) 使用更稳健的交易撮合（如市价 FOK 或逐笔成交监控）。</p>
        </div>

        <div class="section">
            <h2>假设条件</h2>
            <p>未提供实际回测期间、初始资金、滑点模型、订单撮合细节，假设使用聚宽默认撮合(开盘价可用)、默认无额外滑点。, 假设 T−1 日净值数据在回测中由 get_extras 无未来泄露；爬虫在实盘阶段需替换为合规实时数据源。</p>
        </div>

        <div class="section">
            <h2>评分汇总</h2>
            <table>
                <tr><th>指标</th><th>分数</th></tr>
                <tr><td>未来函数风险</td><td>3</td></tr>
                <tr><td>滑点</td><td>3</td></tr>
                <tr><td>成本</td><td>3</td></tr>
                <tr><td>执行难度</td><td>7</td></tr>
                <tr><td>时间敏感性</td><td>6</td></tr>
                <tr><td>综合可执行性</td><td>6.6</td></tr>
                <tr><td>大资金不友好</td><td>6</td></tr>
                <tr><td>行为偏差利用</td><td>6</td></tr>
                <tr><td>跨阶段稳健性</td><td>5</td></tr>
                <tr><td>有效性总分</td><td>5.5</td></tr>
                <tr><td>总分</td><td>60.2</td></tr>
            </table>
        </div>

        <div class="section">
            <h2>原始AI响应</h2>
            <pre>```json
{
    &quot;strategy_name&quot;: &quot;ETF折溢价套利双向轮动&quot;,
    &quot;strategy_type&quot;: &quot;套利策略/均值回归&quot;,
    
    &quot;strategy_explanation&quot;: {
        &quot;core_logic&quot;: &quot;利用场内ETF开盘价与前一交易日基金单位净值（NAV）之间的价差。当开盘价低于NAV达到一定幅度（默认≥2.5%）时认为存在负溢价，买入并持有等待价格回归；当已持有ETF的负溢价消失（不再位于最优折价组合）时卖出。通过反复捕捉日内/隔夜的溢价修复来获取超额收益。&quot;,
        &quot;data_and_indicators&quot;: &quot;1) ETF当日开盘价 current.day_open（盘中9:30获取）\n2) 前一交易日成交金额 history(1d, money)\n3) 基金单位净值 unit_net_value（T−1日官方披露，或通过爬虫抓取T日早间披露值）\n4) 复权因子 attribute_history(...,&#x27;factor&#x27;) 用于排除除权除息扰动\n5) 计算指标：premium = (day_open / unit_net_value −1)*100&quot;,
        &quot;stock_pool&quot;: &quot;全部场内ETF（get_all_securities([&#x27;etf&#x27;])），过滤条件：\n1) 前一交易日成交额&gt;1亿元\n2) 昨日有除权除息(factor==1  保留)\n3) 当日开盘价/NAV溢价绝对值&lt;20%&quot;,
        &quot;buy_signals&quot;: [
            &quot;premium &lt; -g.least_premium（初始2.5%，若连续无法买到则逐日递减至下限1.5%）&quot;,
            &quot;在折价排序中位列前 g.ETFNum_hold(默认2只)&quot;
        ],
        &quot;sell_signals&quot;: [
            &quot;持仓ETF不再位列当日折价前g.ETFNum_hold&quot;,
            &quot;主动划定的负溢价阈值范围之外（即折价不足）&quot;
        ],
        &quot;position_and_risk&quot;: &quot;最多同时持有 g.ETFNum_hold(=2) 只ETF；资金按照可用现金等权分配；买入按百股整数；无止损/止盈；无行业/指数集中度或系统性风险控制；未使用大盘风控函数（虽然代码备注有）。&quot;,
        &quot;trading_frequency&quot;: &quot;每日一次：09:15获取数据，09:30先卖后买。调仓节奏为日频。&quot;,
        &quot;manual_execution_guide&quot;: &quot;盘前：检查昨日公布的各ETF净值；\n09:20~09:28：准备符合折价条件列表；\n09:30 开盘后观察开盘价与NAV差异，若折价达到阈值则以市价/溢价2%限价下单；\n盘后：记录成交与持仓，更新下一交易日折价阈值。&quot;
    },
    
    &quot;future_function_detection&quot;: {
        &quot;has_future_function&quot;: &quot;否&quot;,
        &quot;risk_level&quot;: &quot;低&quot;,
        &quot;risk_score&quot;: 3,
        &quot;risk_score_reason&quot;: &quot;未使用明显未来函数。所有指标仅用到 T 日开盘价与 T−1 日 NAV。使用 current.day_open 于 09:30 发单，在回测中与实盘时序一致（开盘价在 9:30 即已产生），基本不存在前瞻泄漏。少量风险来自对 day_open 的获取时点与回测撮合模型可能的先验差异。&quot;,
        &quot;detailed_analysis&quot;: {
            &quot;price_data_leak&quot;: &quot;在 09:30 事件读取 current.day_open 后立刻下单，理论上开盘价已经产生，属于可实时获知的历史数据；不构成泄漏。&quot;,
            &quot;financial_data_leak&quot;: &quot;unit_net_value 取的是 T−1 日值或通过爬虫在盘前获取的 T 日披露值，不含未来数据。&quot;,
            &quot;index_component_leak&quot;: &quot;未使用未来成分信息，仅采用全市场 ETF 列表。&quot;,
            &quot;backtest_engine_leak&quot;: &quot;无调用回测禁用函数，亦未在 before_trading_start 之外访问未来数据。&quot;
        },
        &quot;fix_suggestions&quot;: &quot;如担心回测开盘价可用时点与真实盘中差异，可将买卖撮合延至 09:31 并使用现价下单；或在交易函数中使用 order_value/MarketOrderStyle 结合滑点模型。&quot;,
        &quot;gray_area_warnings&quot;: [
            &quot;开盘价→限价±2% 下单在回测中几乎肯定成交，实盘可能因涨跌停或流动性导致挂单失败。&quot;,
            &quot;爬虫获取实时 NAV 在聚宽实盘受限（服务器无法外网），需自行部署数据或改用官方IOPV接口。&quot;,
            &quot;未处理分级 ETF、跨境或货币型 ETF 的特殊规则，可能出现净值无法对应。&quot;
        ]
    },
    
    &quot;execution_difficulty&quot;: {
        &quot;slippage_score&quot;: 3,
        &quot;slippage_reason&quot;: &quot;目标资产为日均成交额&gt;1亿的ETF，且使用限价单(±2%)保证成交；预期滑点较低，但遇涨跌停或集合竞价大幅跳空时仍可能扩大。&quot;,
        &quot;cost_score&quot;: 3,
        &quot;cost_reason&quot;: &quot;日内至隔日持有，换手频率低；佣金万2.5（代码设定）仅万分之25，对盈利影响较小。&quot;,
        &quot;execution_score&quot;: 7,
        &quot;execution_reason&quot;: &quot;大部分目标ETF流动性充足，100~1000万资金易于一次性成交；但限仓2只，若折价品种容量有限可能造成拥挤。&quot;,
        &quot;time_sensitivity_score&quot;: 6,
        &quot;time_sensitivity_reason&quot;: &quot;策略依赖开盘瞬间折价差，需 09:30 及时下单；对撮合时点及报价精度较敏感。&quot;,
        &quot;overall_executability&quot;: 7,
        &quot;overall_reason&quot;: &quot;对小～中等资金具备可操作性；需解决实时 NAV 数据源与开盘挂单的技术实现。&quot;,
        &quot;scenario_analysis&quot;: {
            &quot;10w&quot;: &quot;流动性充裕，几乎无冲击，可轻松成交。&quot;,
            &quot;100w&quot;: &quot;仍属安全区间，单日买入&lt;100万/ETF，影响可忽略。&quot;,
            &quot;1000w&quot;: &quot;需分单多日建仓；部分小规模ETF可能容量不足，溢价快速收敛导致难以成交。&quot;,
            &quot;1y&quot;: &quot;难以在有限折价档中足量成交，易显著冲击价格并放大折/溢价；不建议。&quot;
        },
        &quot;improvement_suggestions&quot;: [
            &quot;接入实时 IOPV 数据代替 T−1 NAV，提高折价判定准确度与时效性。&quot;,
            &quot;引入风险敞口管理（如大盘趋势过滤、分散 ETF 行业/资产类型）降低系统性回撤。&quot;
        ]
    },
    
    &quot;effectiveness&quot;: {
        &quot;large_fund_unfriendly_score&quot;: 6,
        &quot;large_fund_unfriendly_reason&quot;: &quot;仅挑选两只折价最深ETF，且多数ETF容量有限；资金越大越难满仓建仓。&quot;,
        &quot;behavioral_bias_score&quot;: 6,
        &quot;behavioral_bias_reason&quot;: &quot;策略利用市场因信息滞后及情绪导致的ETF折溢价偏离，存在一定行为金融效应。&quot;,
        &quot;cross_period_robustness_score&quot;: 5,
        &quot;cross_period_robustness_reason&quot;: &quot;折价机会随流动性、市场情绪、监管政策变化而浮动；简易阈值可能失效，需要动态校准。&quot;,
        &quot;effectiveness_total_score&quot;: 5.8,
        &quot;weight_explanation&quot;: &quot;大资金不友好40%，行为偏差30%，跨阶段稳健30%&quot;,
        &quot;worst_environments&quot;: [
            &quot;单边持续大幅上涨或下跌导致折价机会稀缺&quot;,
            &quot;流动性骤降或ETF大规模申购赎回停牌期间&quot;
        ],
        &quot;verifiable_predictions&quot;: [
            &quot;开盘买入折价&gt;2.5%的ETF后1~5个交易日收益为正&quot;,
            &quot;持仓ETF与NAV价差在T+1大概率收敛至±1%&quot;,
            &quot;折价机会数量在高波动/恐慌行情中明显增多&quot;
        ]
    },
    
    &quot;conclusion&quot;: {
        &quot;verdict&quot;: &quot;简洁的ETF负溢价套利策略，思路清晰，未来函数风险低，但对实时数据来源与开盘成交实施要求较高。&quot;,
        &quot;recommendation&quot;: &quot;小仓实测&quot;,
        &quot;optimization_suggestions&quot;: &quot;1) 引入实时 IOPV 或官方实时估值接口；2) 增加回撤控制与持仓分散；3) 改进仓位/阈值动态调整逻辑；4) 使用更稳健的交易撮合（如市价 FOK 或逐笔成交监控）。&quot;
    },
    
    &quot;score_summary&quot;: {
        &quot;future_function_risk&quot;: 3,
        &quot;slippage&quot;: 3,
        &quot;cost&quot;: 3,
        &quot;execution&quot;: 7,
        &quot;time_sensitivity&quot;: 6,
        &quot;executability&quot;: 7,
        &quot;effectiveness_a&quot;: 6,
        &quot;effectiveness_b&quot;: 6,
        &quot;effectiveness_c&quot;: 5,
        &quot;effectiveness_total&quot;: 5.8
    },
    
    &quot;assumptions&quot;: [
        &quot;未提供实际回测期间、初始资金、滑点模型、订单撮合细节，假设使用聚宽默认撮合(开盘价可用)、默认无额外滑点。&quot;,
        &quot;假设 T−1 日净值数据在回测中由 get_extras 无未来泄露；爬虫在实盘阶段需替换为合规实时数据源。&quot;
    ]
}
```</pre>
        </div>

    </div>
</body>
</html>